<!DOCTYPE html>
<html lang="es" dir="ltr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="description" content="Plataforma soberana de Code Generator para la infraestructura digital de 574 naciones tribales - Ierahkwa Ne Kanienke">
<meta name="theme-color" content="#00FF41">
<link rel="canonical" href="https://ierahkwa.nation/code-generator/">
<link rel="manifest" href="../shared/manifest.json">
<link rel="icon" href="../icons/icon-96.svg" type="image/svg+xml">
<link rel="apple-touch-icon" href="../icons/icon-192.svg">
<meta property="og:title" content="IERAHKWA AI CODE GENERATOR | Software Builder">
<meta property="og:description" content="Plataforma soberana de Code Generator para la infraestructura digital de 574 naciones tribales - Ierahkwa Ne Kanienke">
<meta property="og:type" content="website">
<meta property="og:url" content="https://ierahkwa.nation/code-generator/">
<meta property="og:image" content="https://ierahkwa.nation/icons/icon-512.svg">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="IERAHKWA AI CODE GENERATOR | Software Builder">
<meta name="twitter:description" content="Plataforma soberana de Code Generator para la infraestructura digital de 574 naciones tribales - Ierahkwa Ne Kanienke">
<link rel="stylesheet" href="../shared/ierahkwa.css">
    <title>IERAHKWA AI CODE GENERATOR | Software Builder</title>
    <link rel="stylesheet" href="../shared/bootstrap-icons/bootstrap-icons.min.css">
    <style>:root{--accent:#00FF41}</style>
</head>
<body role="document">
    <a href="#main" class="skip-nav">Skip to main content</a>
    <header class="header">
        <div class="logo">
            <div class="logo-icon" aria-hidden="true">ğŸ§ </div>
            <div>
                <h1>AI CODE GENERATOR</h1>
                <span>IERAHKWA SOFTWARE BUILDER</span>
            </div>
        </div>
        <div class="status-badge">
            <div class="status-dot"></div>
            AI ENGINE ACTIVE â€¢ v2.0
        </div>
    </header>
    
    <main id="main" class="main">
        <!-- Left Sidebar - Modules -->
        <aside class="sidebar">
            <div class="card">
                <div class="card-title"><i class="bi bi-grid-3x3-gap"></i> MODULES</div>
                <div class="module-list">
                    <div class="module-item selected" data-category="banking">
                        <div class="module-icon" style="background: linear-gradient(135deg, #10b981, #059669);">ğŸ¦</div>
                        <div class="module-info">
                            <h4>Banking</h4>
                            <span>6 sub-modules</span>
                        </div>
                    </div>
                    <div class="module-item" data-category="trading">
                        <div class="module-icon" style="background: linear-gradient(135deg, #3b82f6, #1d4ed8);">ğŸ“ˆ</div>
                        <div class="module-info">
                            <h4>Trading</h4>
                            <span>6 sub-modules</span>
                        </div>
                    </div>
                    <div class="module-item" data-category="defi">
                        <div class="module-icon" style="background: linear-gradient(135deg, #8b5cf6, #6d28d9);">âš¡</div>
                        <div class="module-info">
                            <h4>DeFi</h4>
                            <span>6 sub-modules</span>
                        </div>
                    </div>
                    <div class="module-item" data-category="crypto">
                        <div class="module-icon" style="background: linear-gradient(135deg, #f59e0b, #d97706);">â‚¿</div>
                        <div class="module-info">
                            <h4>Crypto</h4>
                            <span>6 sub-modules</span>
                        </div>
                    </div>
                    <div class="module-item" data-category="government">
                        <div class="module-icon" style="background: linear-gradient(135deg, #06b6d4, #0891b2);">ğŸ›ï¸</div>
                        <div class="module-info">
                            <h4>Government</h4>
                            <span>6 sub-modules</span>
                        </div>
                    </div>
                    <div class="module-item" data-category="business">
                        <div class="module-icon" style="background: linear-gradient(135deg, #ec4899, #db2777);">ğŸ’¼</div>
                        <div class="module-info">
                            <h4>Business</h4>
                            <span>6 sub-modules</span>
                        </div>
                    </div>
                    <div class="module-item" data-category="social">
                        <div class="module-icon" style="background: linear-gradient(135deg, #14b8a6, #0d9488);">ğŸ‘¥</div>
                        <div class="module-info">
                            <h4>Social</h4>
                            <span>6 sub-modules</span>
                        </div>
                    </div>
                    <div class="module-item" data-category="gaming">
                        <div class="module-icon" style="background: linear-gradient(135deg, #ef4444, #dc2626);">ğŸ®</div>
                        <div class="module-info">
                            <h4>Gaming</h4>
                            <span>6 sub-modules</span>
                        </div>
                    </div>
                    <div class="module-item" data-category="healthcare">
                        <div class="module-icon" style="background: linear-gradient(135deg, #22c55e, #16a34a);">ğŸ¥</div>
                        <div class="module-info">
                            <h4>Healthcare</h4>
                            <span>5 sub-modules</span>
                        </div>
                    </div>
                    <div class="module-item" data-category="education">
                        <div class="module-icon" style="background: linear-gradient(135deg, #a855f7, #9333ea);">ğŸ“š</div>
                        <div class="module-info">
                            <h4>Education</h4>
                            <span>5 sub-modules</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="card">
                <div class="card-title"><i class="bi bi-code-slash"></i> LANGUAGE</div>
                <div class="lang-grid">
                    <button class="lang-btn active">JavaScript</button>
                    <button class="lang-btn">TypeScript</button>
                    <button class="lang-btn">Python</button>
                    <button class="lang-btn">Rust</button>
                    <button class="lang-btn">Go</button>
                    <button class="lang-btn">C#</button>
                    <button class="lang-btn">Solidity</button>
                    <button class="lang-btn">SQL</button>
                </div>
            </div>
        </aside>
        
        <!-- Main Editor -->
        <section aria-label="Contenido principal" class="editor-container">
            <!-- Prompt Section -->
            <div class="prompt-section">
                <div class="prompt-header">
                    <h3><span aria-hidden="true">ğŸš€</span> DESCRIBE YOUR SOFTWARE</h3>
                    <div class="model-selector">
                        <button class="model-btn active">IERAHKWA-70B</button>
                        <button class="model-btn">Fast Mode</button>
                        <button class="model-btn">Expert Mode</button>
                    </div>
                </div>
                <textarea class="prompt-textarea" id="promptInput" placeholder="Describe quÃ© quieres crear...

Ejemplos:
â€¢ Crea un sistema de pagos con SWIFT MT103 y validaciÃ³n de fraude
â€¢ Genera un mÃ³dulo de staking con APY variable y auto-compound
â€¢ Construye una API REST para gestiÃ³n de ciudadanos con CRUD completo
â€¢ Crea un smart contract ERC-20 con vesting y governance"></textarea>
                <div class="prompt-actions">
                    <div class="prompt-templates">
                        <span class="template-chip" onclick="useTemplate('api')">REST API</span>
                        <span class="template-chip" onclick="useTemplate('defi')">DeFi Module</span>
                        <span class="template-chip" onclick="useTemplate('smart')">Smart Contract</span>
                        <span class="template-chip" onclick="useTemplate('full')">Full Platform</span>
                    </div>
                    <button class="generate-btn" id="generateBtn" onclick="generateCode()">
                        <i class="bi bi-lightning-charge-fill"></i>
                        GENERATE CODE
                    </button>
                </div>
            </div>
            
            <!-- Code Output -->
            <div class="code-section">
                <div class="code-header">
                    <div class="code-tabs">
                        <button class="code-tab active"><i class="bi bi-file-earmark-code"></i> main.js</button>
                        <button class="code-tab"><i class="bi bi-file-earmark-code"></i> routes.js</button>
                        <button class="code-tab"><i class="bi bi-file-earmark-code"></i> models.js</button>
                    </div>
                    <div class="code-actions">
                        <button class="action-btn" onclick="copyCode()"><i class="bi bi-clipboard"></i> Copy</button>
                        <button class="action-btn" onclick="downloadCode()"><i class="bi bi-download"></i> Download</button>
                        <button class="action-btn" onclick="analyzeCode()"><i class="bi bi-shield-check"></i> Analyze</button>
                        <button class="action-btn" onclick="refactorCode()"><i class="bi bi-arrow-repeat"></i> Refactor</button>
                        <button class="action-btn" onclick="explainCode()"><i class="bi bi-question-circle"></i> Explain</button>
                        <button class="action-btn" onclick="deployCode()"><i class="bi bi-cloud-upload"></i> Deploy</button>
                    </div>
                </div>
                <div class="code-editor" id="codeOutput">
                    <pre><span class="comment">/**
 * â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
 *  ğŸ§  IERAHKWA AI CODE GENERATOR
 *  Ready to generate code â€¢ Describe your software above
 * â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
 */</span>

<span class="comment">// Your generated code will appear here...</span>
<span class="comment">// Supported: APIs, Smart Contracts, Full Platforms, Microservices</span>

<span class="keyword">const</span> <span class="function">ierahkwaAI</span> = {
    <span class="string">status</span>: <span class="string">'ready'</span>,
    <span class="string">version</span>: <span class="string">'2.0.0'</span>,
    <span class="string">capabilities</span>: [
        <span class="string">'REST API Generation'</span>,
        <span class="string">'Smart Contract Builder'</span>,
        <span class="string">'DeFi Protocol Creation'</span>,
        <span class="string">'Full Platform Scaffolding'</span>,
        <span class="string">'Database Schema Design'</span>,
        <span class="string">'WebSocket Services'</span>,
        <span class="string">'Microservices Architecture'</span>
    ]
};

<span class="keyword">module</span>.<span class="function">exports</span> = ierahkwaAI;</pre>
                </div>
            </div>
        </section>
        
        <!-- Right Panel -->
        <aside class="right-panel">
            <div class="card">
                <div class="card-title"><i class="bi bi-bar-chart"></i> GENERATION STATS</div>
                <div class="stats-grid">
                    <div class="stat-item">
                        <div class="stat-value" id="statModules">156</div>
                        <div class="stat-label">Modules Generated</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value" id="statLines">48.2K</div>
                        <div class="stat-label">Lines of Code</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value" id="statAPIs">89</div>
                        <div class="stat-label">APIs Created</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value" id="statContracts">23</div>
                        <div class="stat-label">Smart Contracts</div>
                    </div>
                </div>
            </div>
            
            <div class="card">
                <div class="card-title">
                    <i class="bi bi-clock-history"></i> RECENT GENERATIONS
                    <button onclick="clearHistory()" style="background: none; border: none; color: #666; cursor: pointer; font-size: 0.8em; margin-left: auto;">Clear</button>
                </div>
                <div class="history-list" id="historyList">
                    <!-- History will be loaded from localStorage -->
                </div>
            </div>
            
            <div class="card">
                <div class="card-title"><i class="bi bi-cpu"></i> AI MODEL INFO</div>
                <div style="font-size: 0.85em; color: #888; line-height: 1.8;">
                    <div><strong style="color: var(--cyan);">Model:</strong> IERAHKWA-LLM 70B</div>
                    <div><strong style="color: var(--cyan);">Context:</strong> 128K tokens</div>
                    <div><strong style="color: var(--cyan);">Languages:</strong> 15+ supported</div>
                    <div><strong style="color: var(--cyan);">Frameworks:</strong> Express, FastAPI, Actix, Gin</div>
                    <div><strong style="color: var(--cyan);">Training:</strong> Sovereign Code Base</div>
                </div>
            </div>
        </aside>
    </main>

    <script>
        // Templates
        const templates = {
            api: `Create a complete REST API with:
- CRUD operations for the selected module
- Input validation with Joi/Zod
- Error handling middleware
- JWT authentication
- Rate limiting
- OpenAPI documentation`,
            
            defi: `Create a DeFi protocol with:
- Staking mechanism with variable APY
- Liquidity pool management
- Reward distribution system
- Emergency withdrawal function
- Admin controls for parameters`,
            
            smart: `Create a Solidity smart contract with:
- ERC-20 token standard
- Vesting schedule for team tokens
- Governance voting mechanism
- Pausable functionality
- Upgradeable proxy pattern`,
            
            full: `Create a complete platform with:
- Backend API (Express/Node)
- Database schemas (MongoDB/PostgreSQL)
- WebSocket real-time updates
- Frontend components (React)
- Admin dashboard
- Mobile API endpoints`
        };

        function useTemplate(type) {
            document.getElementById('promptInput').value = templates[type];
        }

        // API Configuration
        const API_BASE = window.location.origin.includes('localhost') 
            ? 'http://localhost:3000' 
            : 'https://api.ierahkwa.gov';
        
        // Generate Code - CONNECTED TO REAL AI BACKEND
        async function generateCode() {
            const prompt = document.getElementById('promptInput').value;
            if (!prompt.trim()) {
                alert('Por favor describe quÃ© quieres crear');
                return;
            }
            
            const btn = document.getElementById('generateBtn');
            const output = document.getElementById('codeOutput');
            
            btn.disabled = true;
            btn.innerHTML = '<i class="bi bi-hourglass-split"></i> GENERATING...';
            
            output.innerHTML = `
                <div class="generating">
                    <div class="generating-spinner"></div>
                    <div class="generating-text">ğŸ§  AI is generating your code...</div>
                </div>
            `;
            
            try {
                // Get selected module and language
                const selectedModule = document.querySelector('.module-item.selected')?.dataset.category || 'banking';
                const selectedLang = document.querySelector('.lang-btn.active')?.textContent || 'JavaScript';
                const selectedModel = document.querySelector('.model-btn.active')?.textContent || 'IERAHKWA-70B';
                
                // Build enhanced prompt with context
                const enhancedPrompt = buildEnhancedPrompt(prompt, selectedModule, selectedLang);
                
                // Call real AI API
                const response = await fetch(`${API_BASE}/api/ai/code`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${localStorage.getItem('token') || ''}`
                    },
                    body: JSON.stringify({
                        query: enhancedPrompt,
                        language: selectedLang.toLowerCase(),
                        module: selectedModule,
                        model: selectedModel
                    })
                });
                
                if (!response.ok) {
                    throw new Error(`API Error: ${response.statusText}`);
                }
                
                const data = await response.json();
                
                if (data.success && data.data) {
                    const generatedCode = data.data.content || data.data;
                    output.innerHTML = `<pre>${highlightCode(generatedCode)}</pre>`;
                    
                    // Save to history
                    saveGeneratedCode(prompt, generatedCode, selectedLang, selectedModule);
                } else {
                    throw new Error(data.error || 'Failed to generate code');
                }
                
            } catch (error) {
                console.error('Generation error:', error);
                
                // Fallback to local generation if API fails
                const selectedModule = document.querySelector('.module-item.selected')?.dataset.category || 'banking';
                const selectedLang = document.querySelector('.lang-btn.active')?.textContent || 'JavaScript';
                const generatedCode = generateModuleCode(selectedModule, selectedLang, prompt);
                
                output.innerHTML = `
                    <div style="color: #ff6b6b; margin-bottom: 15px;">
                        âš ï¸ API no disponible, usando generaciÃ³n local. Error: ${error.message}
                    </div>
                    <pre>${highlightCode(generatedCode)}</pre>
                `;
            } finally {
                btn.disabled = false;
                btn.innerHTML = '<i class="bi bi-lightning-charge-fill"></i> GENERATE CODE';
                
                // Update stats
                updateStats();
                addToHistory(prompt, document.querySelector('.lang-btn.active')?.textContent || 'JavaScript');
            }
        }
        
        // Build enhanced prompt with context
        function buildEnhancedPrompt(prompt, module, language) {
            const moduleContext = {
                banking: 'Create banking/financial code with security, validation, and compliance',
                trading: 'Create trading/exchange code with real-time data, WebSocket, and order management',
                defi: 'Create DeFi protocol code with smart contracts, staking, and liquidity pools',
                crypto: 'Create cryptocurrency code with blockchain integration and wallet management',
                government: 'Create government services code with citizen management and document processing',
                business: 'Create business application code with CRM, inventory, and analytics',
                social: 'Create social platform code with user management, feeds, and messaging',
                gaming: 'Create gaming code with real-time multiplayer, leaderboards, and rewards',
                healthcare: 'Create healthcare code with patient records, appointments, and HIPAA compliance',
                education: 'Create education code with courses, students, and learning management'
            };
            
            return `${moduleContext[module] || 'Create production-ready code'} in ${language}.

Requirements:
${prompt}

Please generate:
1. Complete, production-ready code
2. Proper error handling
3. Input validation
4. Security best practices
5. Comments and documentation
6. Following IERAHKWA coding standards

Code:`;
        }
        
        // Save generated code to localStorage
        function saveGeneratedCode(prompt, code, language, module) {
            const history = JSON.parse(localStorage.getItem('codeHistory') || '[]');
            history.unshift({
                id: Date.now(),
                prompt: prompt.substring(0, 100),
                code: code.substring(0, 1000), // Store preview
                language,
                module,
                timestamp: new Date().toISOString(),
                lines: code.split('\n').length
            });
            
            // Keep only last 50
            if (history.length > 50) history.pop();
            
            localStorage.setItem('codeHistory', JSON.stringify(history));
        }

        function generateModuleCode(module, lang, prompt) {
            const moduleName = module.charAt(0).toUpperCase() + module.slice(1);
            
            if (lang === 'JavaScript' || lang === 'TypeScript') {
                return `/**
 * â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
 *  ${moduleName.toUpperCase()} MODULE - Auto-generated by IERAHKWA AI
 *  Sovereign Government of Ierahkwa Ne Kanienke
 *  Generated: ${new Date().toISOString()}
 * â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
 * 
 * Prompt: ${prompt.substring(0, 100)}...
 */

const express = require('express');
const router = express.Router();
const { v4: uuidv4 } = require('uuid');

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  STATE & CONFIGURATION
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

const state = {
    items: [],
    stats: { 
        total: 0, 
        active: 0, 
        processed: 0,
        volume: 0 
    },
    config: {
        maxItems: 10000,
        defaultLimit: 50,
        enableCache: true
    },
    createdAt: Date.now()
};

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  MIDDLEWARE
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

const validateInput = (req, res, next) => {
    // Add input validation logic
    next();
};

const authenticate = (req, res, next) => {
    const token = req.headers.authorization?.split(' ')[1];
    if (!token) {
        return res.status(401).json({ success: false, error: 'Unauthorized' });
    }
    // Verify token logic
    next();
};

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  ROUTES
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

// GET all items with pagination
router.get('/', authenticate, (req, res) => {
    const { page = 1, limit = 50, status, sort = 'createdAt' } = req.query;
    
    let filtered = [...state.items];
    if (status) filtered = filtered.filter(i => i.status === status);
    
    const startIndex = (page - 1) * limit;
    const endIndex = page * limit;
    const paginated = filtered.slice(startIndex, endIndex);
    
    res.json({
        success: true,
        data: paginated,
        pagination: {
            page: parseInt(page),
            limit: parseInt(limit),
            total: filtered.length,
            pages: Math.ceil(filtered.length / limit)
        },
        stats: state.stats
    });
});

// GET single item by ID
router.get('/:id', authenticate, (req, res) => {
    const item = state.items.find(i => i.id === req.params.id);
    if (!item) {
        return res.status(404).json({ 
            success: false, 
            error: 'NOT_FOUND',
            message: 'Item not found' 
        });
    }
    res.json({ success: true, data: item });
});

// POST create new item
router.post('/', authenticate, validateInput, (req, res) => {
    const item = {
        id: uuidv4(),
        ...req.body,
        createdAt: Date.now(),
        updatedAt: Date.now(),
        status: 'active',
        createdBy: req.user?.id || 'system'
    };
    
    state.items.push(item);
    state.stats.total++;
    state.stats.active++;
    
    res.status(201).json({ 
        success: true, 
        data: item,
        message: 'Item created successfully'
    });
});

// PUT update item
router.put('/:id', authenticate, validateInput, (req, res) => {
    const index = state.items.findIndex(i => i.id === req.params.id);
    if (index === -1) {
        return res.status(404).json({ success: false, error: 'Not found' });
    }
    
    state.items[index] = { 
        ...state.items[index], 
        ...req.body, 
        updatedAt: Date.now(),
        updatedBy: req.user?.id || 'system'
    };
    
    res.json({ 
        success: true, 
        data: state.items[index],
        message: 'Item updated successfully'
    });
});

// DELETE item
router.delete('/:id', authenticate, (req, res) => {
    const index = state.items.findIndex(i => i.id === req.params.id);
    if (index === -1) {
        return res.status(404).json({ success: false, error: 'Not found' });
    }
    
    const deleted = state.items.splice(index, 1)[0];
    state.stats.active--;
    
    res.json({ 
        success: true, 
        data: deleted,
        message: 'Item deleted successfully'
    });
});

// GET statistics
router.get('/stats/summary', authenticate, (req, res) => {
    res.json({
        success: true,
        stats: state.stats,
        uptime: Date.now() - state.createdAt,
        config: state.config
    });
});

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  EXPORTS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

module.exports = router;

console.log('âœ“ ${moduleName} module loaded');`;
            }
            
            if (lang === 'Python') {
                return `"""
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
 ${moduleName.toUpperCase()} MODULE - Auto-generated by IERAHKWA AI
 Sovereign Government of Ierahkwa Ne Kanienke
 Generated: ${new Date().toISOString()}
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
"""

from fastapi import FastAPI, HTTPException, Depends, Query
from pydantic import BaseModel, Field
from typing import Optional, List
from datetime import datetime
from uuid import uuid4

app = FastAPI(title="${moduleName} API", version="1.0.0")

# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
#  MODELS
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

class ${moduleName}Item(BaseModel):
    id: str = Field(default_factory=lambda: str(uuid4()))
    name: str
    description: Optional[str] = None
    status: str = "active"
    created_at: datetime = Field(default_factory=datetime.now)
    updated_at: Optional[datetime] = None

class ${moduleName}Create(BaseModel):
    name: str
    description: Optional[str] = None

class ${moduleName}Update(BaseModel):
    name: Optional[str] = None
    description: Optional[str] = None
    status: Optional[str] = None

# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
#  STATE
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

items: List[${moduleName}Item] = []
stats = {"total": 0, "active": 0, "processed": 0}

# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
#  ROUTES
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

@app.get("/", response_model=dict)
async def get_all(
    page: int = Query(1, ge=1),
    limit: int = Query(50, ge=1, le=100),
    status: Optional[str] = None
):
    filtered = items if not status else [i for i in items if i.status == status]
    start = (page - 1) * limit
    end = start + limit
    return {
        "success": True,
        "data": filtered[start:end],
        "total": len(filtered),
        "page": page
    }

@app.get("/{item_id}", response_model=dict)
async def get_one(item_id: str):
    item = next((i for i in items if i.id == item_id), None)
    if not item:
        raise HTTPException(status_code=404, detail="Item not found")
    return {"success": True, "data": item}

@app.post("/", response_model=dict, status_code=201)
async def create(data: ${moduleName}Create):
    item = ${moduleName}Item(**data.dict())
    items.append(item)
    stats["total"] += 1
    stats["active"] += 1
    return {"success": True, "data": item}

@app.put("/{item_id}", response_model=dict)
async def update(item_id: str, data: ${moduleName}Update):
    item = next((i for i in items if i.id == item_id), None)
    if not item:
        raise HTTPException(status_code=404, detail="Item not found")
    for key, value in data.dict(exclude_unset=True).items():
        setattr(item, key, value)
    item.updated_at = datetime.now()
    return {"success": True, "data": item}

@app.delete("/{item_id}", response_model=dict)
async def delete(item_id: str):
    global items
    item = next((i for i in items if i.id == item_id), None)
    if not item:
        raise HTTPException(status_code=404, detail="Item not found")
    items = [i for i in items if i.id != item_id]
    stats["active"] -= 1
    return {"success": True, "data": item}

@app.get("/stats/summary", response_model=dict)
async def get_stats():
    return {"success": True, "stats": stats}

print(f"âœ“ ${moduleName} module loaded")`;
            }
            
            if (lang === 'Solidity') {
                return `// SPDX-License-Identifier: MIT
pragma solidity ^0.8.20;

/**
 * â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
 *  ${moduleName.toUpperCase()} CONTRACT - Auto-generated by IERAHKWA AI
 *  Sovereign Government of Ierahkwa Ne Kanienke
 *  Generated: ${new Date().toISOString()}
 * â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
 */

import "@openzeppelin/contracts/token/ERC20/ERC20.sol";
import "@openzeppelin/contracts/security/ReentrancyGuard.sol";
import "@openzeppelin/contracts/access/Ownable.sol";
import "@openzeppelin/contracts/security/Pausable.sol";

contract ${moduleName}Token is ERC20, ReentrancyGuard, Ownable, Pausable {
    
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    //  STATE VARIABLES
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    
    uint256 public constant MAX_SUPPLY = 1_000_000_000 * 10**18; // 1B tokens
    uint256 public stakingAPY = 1200; // 12% APY (basis points)
    uint256 public minStakeAmount = 100 * 10**18;
    
    mapping(address => uint256) public stakedBalance;
    mapping(address => uint256) public stakeTimestamp;
    mapping(address => uint256) public rewards;
    
    uint256 public totalStaked;
    
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    //  EVENTS
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    
    event Staked(address indexed user, uint256 amount);
    event Unstaked(address indexed user, uint256 amount);
    event RewardsClaimed(address indexed user, uint256 amount);
    event APYUpdated(uint256 oldAPY, uint256 newAPY);
    
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    //  CONSTRUCTOR
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    
    constructor() ERC20("${moduleName} Token", "IGT-${module.substring(0,3).toUpperCase()}") Ownable(msg.sender) {
        _mint(msg.sender, MAX_SUPPLY);
    }
    
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    //  STAKING FUNCTIONS
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    
    function stake(uint256 amount) external nonReentrant whenNotPaused {
        require(amount >= minStakeAmount, "Below minimum stake");
        require(balanceOf(msg.sender) >= amount, "Insufficient balance");
        
        // Claim pending rewards first
        if (stakedBalance[msg.sender] > 0) {
            _claimRewards(msg.sender);
        }
        
        _transfer(msg.sender, address(this), amount);
        stakedBalance[msg.sender] += amount;
        stakeTimestamp[msg.sender] = block.timestamp;
        totalStaked += amount;
        
        emit Staked(msg.sender, amount);
    }
    
    function unstake(uint256 amount) external nonReentrant {
        require(stakedBalance[msg.sender] >= amount, "Insufficient staked");
        
        _claimRewards(msg.sender);
        
        stakedBalance[msg.sender] -= amount;
        totalStaked -= amount;
        _transfer(address(this), msg.sender, amount);
        
        emit Unstaked(msg.sender, amount);
    }
    
    function claimRewards() external nonReentrant {
        _claimRewards(msg.sender);
    }
    
    function _claimRewards(address user) internal {
        uint256 pending = calculateRewards(user);
        if (pending > 0) {
            rewards[user] = 0;
            stakeTimestamp[user] = block.timestamp;
            _mint(user, pending);
            emit RewardsClaimed(user, pending);
        }
    }
    
    function calculateRewards(address user) public view returns (uint256) {
        if (stakedBalance[user] == 0) return 0;
        
        uint256 timeStaked = block.timestamp - stakeTimestamp[user];
        uint256 annualReward = (stakedBalance[user] * stakingAPY) / 10000;
        return (annualReward * timeStaked) / 365 days;
    }
    
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    //  ADMIN FUNCTIONS
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    
    function setAPY(uint256 newAPY) external onlyOwner {
        require(newAPY <= 5000, "APY too high"); // Max 50%
        emit APYUpdated(stakingAPY, newAPY);
        stakingAPY = newAPY;
    }
    
    function setMinStake(uint256 amount) external onlyOwner {
        minStakeAmount = amount;
    }
    
    function pause() external onlyOwner {
        _pause();
    }
    
    function unpause() external onlyOwner {
        _unpause();
    }
    
    function emergencyWithdraw() external onlyOwner {
        uint256 balance = balanceOf(address(this)) - totalStaked;
        if (balance > 0) {
            _transfer(address(this), owner(), balance);
        }
    }
}`;
            }
            
            // Default
            return `// Generated code for ${moduleName} in ${lang}\n// Prompt: ${prompt}`;
        }

        function highlightCode(code) {
            return code
                .replace(/\/\/.*$/gm, '<span class="comment">$&</span>')
                .replace(/\/\*[\s\S]*?\*\//gm, '<span class="comment">$&</span>')
                .replace(/#.*$/gm, '<span class="comment">$&</span>')
                .replace(/"""[\s\S]*?"""/gm, '<span class="comment">$&</span>')
                .replace(/\b(const|let|var|function|async|await|return|if|else|for|while|class|import|export|from|require|module|extends|implements|interface|type|enum|public|private|protected|static|readonly|abstract|virtual|override|new|this|super|try|catch|throw|finally|pragma|solidity|contract|mapping|event|emit|external|internal|view|pure|payable|memory|storage|calldata)\b/g, '<span class="keyword">$1</span>')
                .replace(/\b(def|class|import|from|return|if|elif|else|for|while|try|except|raise|with|as|async|await|lambda|yield|global|nonlocal|assert|pass|break|continue|True|False|None)\b/g, '<span class="keyword">$1</span>')
                .replace(/'[^']*'|"[^"]*"|`[^`]*`/g, '<span class="string">$&</span>')
                .replace(/\b(\d+\.?\d*)\b/g, '<span class="number">$1</span>');
        }

        function copyCode() {
            const code = document.getElementById('codeOutput').innerText;
            navigator.clipboard.writeText(code);
            alert('CÃ³digo copiado al portapapeles');
        }

        function downloadCode() {
            const code = document.getElementById('codeOutput').innerText;
            if (!code || code.includes('Your generated code will appear here')) {
                alert('No hay cÃ³digo para descargar');
                return;
            }
            
            const selectedLang = document.querySelector('.lang-btn.active')?.textContent || 'JavaScript';
            const selectedModule = document.querySelector('.module-item.selected')?.dataset.category || 'module';
            
            // Determine file extension
            const extensions = {
                'JavaScript': 'js',
                'TypeScript': 'ts',
                'Python': 'py',
                'Rust': 'rs',
                'Go': 'go',
                'C#': 'cs',
                'Solidity': 'sol',
                'SQL': 'sql'
            };
            
            const ext = extensions[selectedLang] || 'txt';
            const filename = `${selectedModule}-${Date.now()}.${ext}`;
            
            const blob = new Blob([code], { type: 'text/plain' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = filename;
            a.click();
            URL.revokeObjectURL(url);
            
            // Show success message
            const btn = event.target;
            const originalText = btn.innerHTML;
            btn.innerHTML = '<i class="bi bi-check-circle"></i> Downloaded!';
            setTimeout(() => {
                btn.innerHTML = originalText;
            }, 2000);
        }

        // Analyze code for security, performance, and best practices
        async function analyzeCode() {
            const code = document.getElementById('codeOutput').innerText;
            if (!code || code.includes('Your generated code will appear here')) {
                alert('No hay cÃ³digo para analizar');
                return;
            }
            
            try {
                const response = await fetch(`${API_BASE}/api/ai/analyze`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${localStorage.getItem('token') || ''}`
                    },
                    body: JSON.stringify({
                        content: code,
                        type: 'code_analysis'
                    })
                });
                
                const data = await response.json();
                
                if (data.success) {
                    const analysis = data.data.content || data.data;
                    alert(`AnÃ¡lisis de CÃ³digo:\n\n${analysis.substring(0, 500)}...`);
                } else {
                    // Fallback analysis
                    analyzeCodeLocal(code);
                }
            } catch (error) {
                analyzeCodeLocal(code);
            }
        }
        
        function analyzeCodeLocal(code) {
            const issues = [];
            const warnings = [];
            
            // Security checks
            if (code.includes('eval(')) issues.push('âš ï¸ SECURITY: eval() detected - potential security risk');
            if (code.includes('innerHTML') && !code.includes('sanitize')) warnings.push('âš ï¸ XSS Risk: innerHTML without sanitization');
            if (code.includes('password') && !code.includes('hash')) warnings.push('âš ï¸ SECURITY: Password storage without hashing');
            
            // Performance checks
            if (code.match(/for\s*\([^)]*\)\s*{[\s\S]*for\s*\([^)]*\)\s*{/)) warnings.push('âš ï¸ PERFORMANCE: Nested loops detected');
            if (code.includes('document.querySelector') && code.match(/document\.querySelector/g).length > 5) warnings.push('âš ï¸ PERFORMANCE: Multiple DOM queries - consider caching');
            
            // Best practices
            if (!code.includes('try') && code.includes('async')) warnings.push('ğŸ’¡ SUGGESTION: Add error handling for async operations');
            if (!code.includes('//') && code.split('\n').length > 20) warnings.push('ğŸ’¡ SUGGESTION: Add comments for complex logic');
            
            const analysis = [
                'â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•',
                'ğŸ“Š ANÃLISIS DE CÃ“DIGO',
                'â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n',
                `LÃ­neas de cÃ³digo: ${code.split('\n').length}`,
                `Caracteres: ${code.length}\n`,
                issues.length > 0 ? `ğŸš¨ PROBLEMAS CRÃTICOS (${issues.length}):\n${issues.join('\n')}\n` : 'âœ… No se encontraron problemas crÃ­ticos\n',
                warnings.length > 0 ? `âš ï¸ ADVERTENCIAS (${warnings.length}):\n${warnings.join('\n')}` : 'âœ… No se encontraron advertencias'
            ].join('\n');
            
            alert(analysis);
        }
        
        // Refactor code to improve quality
        async function refactorCode() {
            const code = document.getElementById('codeOutput').innerText;
            if (!code || code.includes('Your generated code will appear here')) {
                alert('No hay cÃ³digo para refactorizar');
                return;
            }
            
            const btn = event.target;
            const originalText = btn.innerHTML;
            btn.disabled = true;
            btn.innerHTML = '<i class="bi bi-hourglass-split"></i> Refactoring...';
            
            try {
                const selectedLang = document.querySelector('.lang-btn.active')?.textContent || 'JavaScript';
                
                const response = await fetch(`${API_BASE}/api/ai/code`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${localStorage.getItem('token') || ''}`
                    },
                    body: JSON.stringify({
                        query: `Refactor the following ${selectedLang} code to improve:
- Code quality and readability
- Performance optimization
- Security best practices
- Error handling
- Code organization

Original code:
\`\`\`${selectedLang.toLowerCase()}
${code}
\`\`\`

Provide the refactored code with explanations of changes.`,
                        language: selectedLang.toLowerCase()
                    })
                });
                
                const data = await response.json();
                
                if (data.success && data.data) {
                    const refactored = data.data.content || data.data;
                    document.getElementById('codeOutput').innerHTML = `<pre>${highlightCode(refactored)}</pre>`;
                } else {
                    alert('Error al refactorizar cÃ³digo');
                }
            } catch (error) {
                alert('Error: ' + error.message);
            } finally {
                btn.disabled = false;
                btn.innerHTML = originalText;
            }
        }
        
        // Explain code functionality
        async function explainCode() {
            const code = document.getElementById('codeOutput').innerText;
            if (!code || code.includes('Your generated code will appear here')) {
                alert('No hay cÃ³digo para explicar');
                return;
            }
            
            try {
                const response = await fetch(`${API_BASE}/api/ai/chat`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${localStorage.getItem('token') || ''}`
                    },
                    body: JSON.stringify({
                        message: `Explain what this code does in Spanish, step by step:\n\n\`\`\`\n${code.substring(0, 2000)}\n\`\`\``,
                        systemPrompt: 'You are a code explanation assistant. Explain code clearly and in detail.'
                    })
                });
                
                const data = await response.json();
                
                if (data.success && data.data) {
                    const explanation = data.data.content || data.data;
                    
                    // Show explanation in a modal or alert
                    const explanationWindow = window.open('', '_blank', 'width=800,height=600');
                    explanationWindow.document.write(`
                        <html>
                            <head>
                                <title>ExplicaciÃ³n del CÃ³digo</title>
                                <style>
                                    body { 
                                        font-family: 'JetBrains Mono', monospace; 
                                        background: #0a0e17; 
                                        color: #fff; 
                                        padding: 20px; 
                                        line-height: 1.8;
                                    }
                                    pre { background: #0d1a2d; padding: 15px; border-radius: 8px; }
                                </style>
                            </head>
                            <body>
                                <h1>ğŸ“š ExplicaciÃ³n del CÃ³digo</h1>
                                <pre>${explanation.replace(/\n/g, '<br>')}</pre>
                            
<script src="../shared/ierahkwa-api.js"></script>
<script>
// Auto-connect to /api/nexus
window.PLATFORM_API = '/api/nexus';
if (!Ierahkwa.auth.isLoggedIn()) {
    console.log('[code-generator] Not logged in â€” showing login modal');
}
</script>
<script src="../shared/ierahkwa-security.js"></script>
<script src="../shared/ierahkwa-quantum.js"></script>
<script src="../shared/ierahkwa-protocols.js"></script>
<script src="../shared/ierahkwa-interconnect.js"></script>
<script>if("serviceWorker"in navigator){navigator.serviceWorker.register("../shared/sw.js").catch(function(){})}</script>
<script src="../shared/ierahkwa-agents.js"></script>
</body>
                        </html>
                    `);
                } else {
                    alert('Error al generar explicaciÃ³n');
                }
            } catch (error) {
                alert('Error: ' + error.message);
            }
        }
        
        function deployCode() {
            const code = document.getElementById('codeOutput').innerText;
            if (!code || code.includes('Your generated code will appear here')) {
                alert('No hay cÃ³digo para desplegar');
                return;
            }
            
            if (confirm('Â¿Desplegar cÃ³digo a IERAHKWA Platform?')) {
                // TODO: Implement actual deployment
                alert('ğŸš€ Desplegando a IERAHKWA Platform...\n\nEsta funcionalidad se conectarÃ¡ al sistema de deployment automÃ¡tico.');
            }
        }

        function updateStats() {
            const modules = parseInt(document.getElementById('statModules').textContent) + 1;
            document.getElementById('statModules').textContent = modules;
            
            const lines = parseFloat(document.getElementById('statLines').textContent.replace('K', '')) + 0.3;
            document.getElementById('statLines').textContent = lines.toFixed(1) + 'K';
        }

        function addToHistory(prompt, lang) {
            const title = prompt.substring(0, 30) + (prompt.length > 30 ? '...' : '');
            const code = document.getElementById('codeOutput').innerText;
            const lines = code.split('\n').length;
            
            // Save to localStorage
            const history = JSON.parse(localStorage.getItem('codeHistory') || '[]');
            const newItem = {
                id: Date.now(),
                title,
                prompt,
                lang,
                lines,
                timestamp: Date.now()
            };
            history.unshift(newItem);
            if (history.length > 20) history.pop();
            localStorage.setItem('codeHistory', JSON.stringify(history));
            
            // Update UI
            loadHistory();
        }
        
        function loadHistory() {
            const history = JSON.parse(localStorage.getItem('codeHistory') || '[]');
            const historyList = document.getElementById('historyList');
            
            if (history.length === 0) {
                historyList.innerHTML = '<div style="color: #666; padding: 20px; text-align: center;">No hay historial aÃºn</div>';
                return;
            }
            
            historyList.innerHTML = history.map(item => {
                const timeAgo = getTimeAgo(item.timestamp);
                return `
                    <div class="history-item" onclick="loadFromHistory(${item.id})">
                        <h5>${item.title}</h5>
                        <span>${item.lang} â€¢ ${item.lines} lines â€¢ ${timeAgo}</span>
                    </div>
                `;
            }).join('');
        }
        
        function getTimeAgo(timestamp) {
            const seconds = Math.floor((Date.now() - timestamp) / 1000);
            if (seconds < 60) return 'Just now';
            const minutes = Math.floor(seconds / 60);
            if (minutes < 60) return `${minutes} min ago`;
            const hours = Math.floor(minutes / 60);
            if (hours < 24) return `${hours} hour${hours > 1 ? 's' : ''} ago`;
            const days = Math.floor(hours / 24);
            return `${days} day${days > 1 ? 's' : ''} ago`;
        }
        
        function loadFromHistory(id) {
            const history = JSON.parse(localStorage.getItem('codeHistory') || '[]');
            const item = history.find(h => h.id === id);
            if (item) {
                document.getElementById('promptInput').value = item.prompt;
                // Could load the full code if stored
            }
        }
        
        function clearHistory() {
            if (confirm('Â¿Eliminar todo el historial?')) {
                localStorage.removeItem('codeHistory');
                loadHistory();
            }
        }
        
        // Load history on page load
        document.addEventListener('DOMContentLoaded', () => {
            loadHistory();
        });

        // Module selection
        document.querySelectorAll('.module-item').forEach(item => {
            item.addEventListener('click', () => {
                document.querySelectorAll('.module-item').forEach(i => i.classList.remove('selected'));
                item.classList.add('selected');
            });
        });

        // Language selection
        document.querySelectorAll('.lang-btn').forEach(btn => {
            btn.addEventListener('click', () => {
                document.querySelectorAll('.lang-btn').forEach(b => b.classList.remove('active'));
                btn.classList.add('active');
            });
        });

        // Model selection
        document.querySelectorAll('.model-btn').forEach(btn => {
            btn.addEventListener('click', () => {
                document.querySelectorAll('.model-btn').forEach(b => b.classList.remove('active'));
                btn.classList.add('active');
            });
        });
    </script>
<script>if("serviceWorker"in navigator){navigator.serviceWorker.register("../shared/sw.js").catch(function(){})}</script>
</body>
</html>
