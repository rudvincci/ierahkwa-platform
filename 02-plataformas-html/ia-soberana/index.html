<!DOCTYPE html><html lang="es" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta http-equiv="X-Content-Type-Options" content="nosniff">
<meta http-equiv="X-Frame-Options" content="SAMEORIGIN">
<meta http-equiv="Referrer-Policy" content="strict-origin-when-cross-origin">
<meta http-equiv="Permissions-Policy" content="camera=(), microphone=(), geolocation=(self), payment=()">
<meta name="description" content="Plataforma soberana de Ia para la infraestructura digital de 574 naciones tribales - Ierahkwa Ne Kanienke">
<meta name="theme-color" content="#00e676">
<link rel="canonical" href="https://ierahkwa.nation/ia-soberana/">
<link rel="manifest" href="../shared/manifest.json">
<link rel="icon" href="../icons/icon-96.svg" type="image/svg+xml">
<link rel="apple-touch-icon" href="../icons/icon-192.svg">
<meta property="og:title" content="IA Soberana ‚Äî Inteligencia Artificial Offline">
<meta property="og:description" content="Plataforma soberana de Ia para la infraestructura digital de 574 naciones tribales - Ierahkwa Ne Kanienke">
<meta property="og:type" content="website">
<meta property="og:url" content="https://ierahkwa.nation/ia-soberana/">
<meta property="og:image" content="https://ierahkwa.nation/icons/icon-512.svg">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="IA Soberana ‚Äî Inteligencia Artificial Offline">
<meta name="twitter:description" content="Plataforma soberana de Ia para la infraestructura digital de 574 naciones tribales - Ierahkwa Ne Kanienke">
<link rel="stylesheet" href="../shared/ierahkwa.css">
<title>IA Soberana ‚Äî Inteligencia Artificial Offline</title>
<style>:root{--accent:#00e676}</style>
</head>
<body role="document">
<a href="#main" class="skip-nav">Saltar al contenido principal</a>
<nav aria-label="Navegaci&oacute;n principal">
  <div class="logo"><span aria-hidden="true">üß†</span> IA Soberana</div>
  <ul class="nav-links">
    <li><a href="#demos">Demos</a></li>
    <li><a href="#estado">Estado</a></li>
    <li><a href="#privacidad">Privacidad</a></li>
  </ul>
</nav>
<main id="main">
  <!-- Hero -->
  <section class="hero">
    <div class="orb" style="width:500px;height:500px;background:var(--accent);top:-10%;left:-10%"></div>
    <div class="orb" style="width:350px;height:350px;background:var(--gold);bottom:-5%;right:-5%"></div>
    <div class="hero-badge">AI Offline</div>
    <h1>Inteligencia Artificial Soberana</h1>
    <p class="tagline">100% en tu dispositivo &mdash; Zero datos salen de tu navegador</p>
    <div class="stats">
      <div class="stat float" style="animation-delay:0s"><div class="stat-value">7</div><div class="stat-label">Modelos</div></div>
      <div class="stat float" style="animation-delay:.5s"><div class="stat-value">&lt; 200MB</div><div class="stat-label">Total</div></div>
      <div class="stat float" style="animation-delay:1s"><div class="stat-value">WebAssembly</div><div class="stat-label">Runtime</div></div>
      <div class="stat float" style="animation-delay:1.5s"><div class="stat-value">100%</div><div class="stat-label">Privado</div></div>
    </div>
  </section>
  <div class="glow-line"></div>

  <!-- Demos -->
  <section class="section" id="demos">
    <h2 class="section-title">Demos Interactivos</h2>
    <p class="section-sub">Prueba la IA directamente en tu navegador. Ning&uacute;n dato sale de tu dispositivo.</p>
    <div class="grid">

      <!-- 1. Sentimiento -->
      <article class="card" id="card-sentimiento">
        <div class="card-icon" aria-hidden="true">üòä</div>
        <h3>An&aacute;lisis de Sentimiento</h3>
        <p>Detecta si un texto es positivo, negativo o neutro.</p>
        <textarea class="demo-textarea" id="sentimiento-input" placeholder="Escribe un texto para analizar su sentimiento..." aria-label="Texto para an&aacute;lisis de sentimiento"></textarea>
        <button class="demo-btn" id="sentimiento-btn" aria-label="Analizar sentimiento"><span class="btn-text">Analizar</span></button>
        <div class="demo-result" id="sentimiento-result" aria-live="polite">Resultado aparecer&aacute; aqu&iacute;</div>
      </article>

      <!-- 2. Clasificacion -->
      <article class="card" id="card-clasificacion">
        <div class="card-icon" aria-hidden="true">üè∑</div>
        <h3>Clasificaci&oacute;n de Texto</h3>
        <p>Clasifica texto en categor&iacute;as autom&aacute;ticamente.</p>
        <textarea class="demo-textarea" id="clasificacion-input" placeholder="Escribe un texto para clasificar..." aria-label="Texto para clasificaci&oacute;n"></textarea>
        <button class="demo-btn" id="clasificacion-btn" aria-label="Clasificar texto"><span class="btn-text">Clasificar</span></button>
        <div class="demo-result" id="clasificacion-result" aria-live="polite">Resultado aparecer&aacute; aqu&iacute;</div>
      </article>

      <!-- 3. Traduccion -->
      <article class="card" id="card-traduccion">
        <div class="card-icon" aria-hidden="true">üåê</div>
        <h3>Traducci&oacute;n ES/EN</h3>
        <p>Traduce entre espa&ntilde;ol e ingl&eacute;s sin conexi&oacute;n.</p>
        <div class="demo-row">
          <div style="flex:1">
            <label class="demo-label" for="traduccion-src">Espa&ntilde;ol</label>
            <textarea class="demo-textarea" id="traduccion-src" placeholder="Escribe en espa&ntilde;ol..." aria-label="Texto en espa&ntilde;ol"></textarea>
          </div>
          <button class="swap-btn" id="traduccion-swap" aria-label="Intercambiar idiomas" title="Intercambiar idiomas">&#8644;</button>
          <div style="flex:1">
            <label class="demo-label" for="traduccion-tgt">Ingl&eacute;s</label>
            <textarea class="demo-textarea" id="traduccion-tgt" placeholder="Traducci&oacute;n aparecer&aacute; aqu&iacute;..." aria-label="Texto en ingl&eacute;s" readonly></textarea>
          </div>
        </div>
        <button class="demo-btn" id="traduccion-btn" aria-label="Traducir texto"><span class="btn-text">Traducir</span></button>
        <div class="demo-result" id="traduccion-result" aria-live="polite" style="display:none"></div>
      </article>

      <!-- 4. Entidades NER -->
      <article class="card" id="card-ner">
        <div class="card-icon" aria-hidden="true">üîç</div>
        <h3>Entidades NER</h3>
        <p>Detecta personas, organizaciones y ubicaciones en texto.</p>
        <textarea class="demo-textarea" id="ner-input" placeholder="Escribe texto con nombres de personas, organizaciones o lugares..." aria-label="Texto para detecci&oacute;n de entidades"></textarea>
        <button class="demo-btn" id="ner-btn" aria-label="Detectar entidades"><span class="btn-text">Detectar</span></button>
        <div class="demo-result" id="ner-result" aria-live="polite">
          <div style="margin-bottom:.4rem;font-size:.75rem;color:var(--txt2)">
            <span class="ner-entity ner-PER">PER</span> Persona
            <span class="ner-entity ner-ORG" style="margin-left:.5rem">ORG</span> Organizaci&oacute;n
            <span class="ner-entity ner-LOC" style="margin-left:.5rem">LOC</span> Ubicaci&oacute;n
          </div>
          Resultado aparecer&aacute; aqu&iacute;
        </div>
      </article>

      <!-- 5. Clasificacion Imagen -->
      <article class="card" id="card-imagen">
        <div class="card-icon" aria-hidden="true">üñº</div>
        <h3>Clasificaci&oacute;n de Imagen</h3>
        <p>Identifica objetos en im&aacute;genes directamente en tu dispositivo.</p>
        <div class="drop-zone" id="imagen-dropzone" aria-label="Zona para soltar imagen">
          <input type="file" id="imagen-file" accept="image/*" aria-label="Seleccionar imagen">
          <span aria-hidden="true">üìÅ</span> Arrastra una imagen o haz clic para seleccionar
        </div>
        <div class="demo-result" id="imagen-result" aria-live="polite">Resultado aparecer&aacute; aqu&iacute;</div>
      </article>

      <!-- 6. Embeddings -->
      <article class="card" id="card-embeddings">
        <div class="card-icon" aria-hidden="true">üìê</div>
        <h3>Similitud de Embeddings</h3>
        <p>Compara la similitud sem&aacute;ntica entre dos textos.</p>
        <label class="demo-label" for="embed-a">Texto A</label>
        <input class="demo-input" id="embed-a" type="text" placeholder="Primer texto..." aria-label="Primer texto para comparar">
        <label class="demo-label" for="embed-b" style="margin-top:.5rem">Texto B</label>
        <input class="demo-input" id="embed-b" type="text" placeholder="Segundo texto..." aria-label="Segundo texto para comparar">
        <button class="demo-btn" id="embed-btn" aria-label="Comparar textos"><span class="btn-text">Comparar</span></button>
        <div class="demo-result" id="embed-result" aria-live="polite">
          <div class="similarity-score" id="embed-score">--</div>
          <div class="similarity-gauge"><div class="similarity-fill" id="embed-gauge" style="width:0%"></div></div>
          <div style="text-align:center;font-size:.75rem;color:var(--txt2);margin-top:.35rem">Similitud coseno (0 = diferente, 1 = id&eacute;ntico)</div>
        </div>
      </article>

    </div>
  </section>

  <div class="glow-line" style="margin:2rem auto"></div>

  <!-- Estado del Sistema -->
  <section class="section" id="estado">
    <h2 class="section-title">Estado del Sistema</h2>
    <p class="section-sub">Informaci&oacute;n en tiempo real sobre el motor de IA local.</p>
    <div class="status-panel" id="status-panel">
      <div class="status-item">
        <div class="status-val" id="status-backend">Detectando...</div>
        <div class="status-lbl">Backend de IA</div>
      </div>
      <div class="status-item">
        <div class="status-val" id="status-models">0 / 7</div>
        <div class="status-lbl">Modelos en Cach&eacute;</div>
      </div>
      <div class="status-item">
        <div class="status-val" id="status-storage">0 MB</div>
        <div class="status-lbl">Almacenamiento Usado</div>
      </div>
      <div class="status-item">
        <div class="status-val" id="status-connectivity"><span class="status-indicator status-online" id="status-dot"></span><span id="status-online-text">Online</span></div>
        <div class="status-lbl">Conectividad</div>
      </div>
      <button class="download-all-btn" id="download-all-btn" aria-label="Descargar todos los modelos">
        <span class="btn-text"><span aria-hidden="true">‚¨á</span> Descargar todos los modelos</span>
      </button>
    </div>
  </section>

  <div class="glow-line" style="margin:2rem auto"></div>

  <!-- Privacidad -->
  <section class="section" id="privacidad">
    <div class="shield-icon" aria-hidden="true">üõ°</div>
    <h2 class="section-title">Soberan&iacute;a de Datos</h2>
    <p class="section-sub">Tu informaci&oacute;n nunca abandona tu dispositivo. Sin excepciones.</p>
    <div class="privacy-grid">
      <article class="card">
        <div class="card-icon" aria-hidden="true">üì±</div>
        <h3>On-Device Only</h3>
        <p>Toda la inferencia de IA ocurre exclusivamente en tu dispositivo. Ning&uacute;n dato se transmite a servidores externos bajo ninguna circunstancia.</p>
      </article>
      <article class="card">
        <div class="card-icon" aria-hidden="true">üì°</div>
        <h3>Zero Telemetr&iacute;a</h3>
        <p>Sin rastreo, sin an&aacute;litica, sin beacons. Cero telemetr&iacute;a. Ni siquiera sabemos que existes.</p>
      </article>
      <article class="card">
        <div class="card-icon" aria-hidden="true">ü™∂</div>
        <h3>UNDRIP Compliant</h3>
        <p>Cumple con la Declaraci&oacute;n de las Naciones Unidas sobre los Derechos de los Pueblos Ind&iacute;genas. Soberan&iacute;a digital como derecho fundamental.</p>
      </article>
      <article class="card">
        <div class="card-icon" aria-hidden="true">üîê</div>
        <h3>Post-Quantum Ready</h3>
        <p>Criptograf&iacute;a resistente a computaci&oacute;n cu&aacute;ntica. Tus datos estar&aacute;n seguros hoy y en el futuro post-cu&aacute;ntico.</p>
      </article>
    </div>
  </section>

</main>
<footer>
  <p><span aria-hidden="true">üß†</span> Ierahkwa Platform v3.3.0 &mdash; IA Soberana &mdash; 192 Plataformas &mdash; 72M+ Personas</p>
<div style="margin-top:.75rem"><span class="security-badge" data-grade="A+" title="Seguridad Soberana Activa"><span class="sec-icon" aria-hidden="true">üõ°Ô∏è</span> Seguro</span></div></footer>

<script src="../shared/ierahkwa-ai.js"></script>
<script>
(function(){
  'use strict';

  /* ‚îÄ‚îÄ Helpers ‚îÄ‚îÄ */
  var AI = window.IerahkwaAI || null;

  function $(id){ return document.getElementById(id); }

  function showLoading(btn){
    var t = btn.querySelector('.btn-text');
    if(t) t.dataset.orig = t.textContent;
    if(t) t.innerHTML = '<span class="spinner"></span>Cargando modelo...';
    btn.disabled = true;
  }

  function hideLoading(btn, label){
    var t = btn.querySelector('.btn-text');
    if(t) t.textContent = label || t.dataset.orig || 'Listo';
    btn.disabled = false;
  }

  function showError(el, msg){
    el.classList.remove('active');
    el.innerHTML = '<span style="color:#ff6b6b">' + (msg || 'Error desconocido. Verifica que el modelo est&eacute; descargado.') + '</span>';
  }

  function latencyBadge(ms, source){
    var cls = source === 'local' ? 'latency-local' : 'latency-server';
    return '<span class="latency-badge ' + cls + '">' + ms + 'ms &middot; ' + source + '</span>';
  }

  function ensureAI(callback){
    if(AI) return callback(AI);
    if(window.IerahkwaAI){ AI = window.IerahkwaAI; return callback(AI); }
    showError(document.querySelector('.demo-result'), 'IerahkwaAI no est&aacute; disponible. Aseg&uacute;rate de que ierahkwa-ai.js est&eacute; cargado.');
  }

  /* ‚îÄ‚îÄ 1. Sentimiento ‚îÄ‚îÄ */
  $('sentimiento-btn').addEventListener('click', function(){
    var btn = this;
    var input = $('sentimiento-input').value.trim();
    var result = $('sentimiento-result');
    if(!input){ result.textContent = 'Por favor escribe un texto para analizar.'; return; }
    showLoading(btn);
    result.innerHTML = '<span class="spinner"></span> Analizando...';
    ensureAI(function(ai){
      var t0 = performance.now();
      ai.sentiment(input).then(function(res){
        var ms = Math.round(performance.now() - t0);
        var src = res.source || 'local';
        var label = res.label || 'neutro';
        var score = typeof res.score === 'number' ? res.score : 0.5;
        var colors = { positivo: 'var(--accent)', negativo: '#ff6b6b', neutro: 'var(--gold)' };
        var color = colors[label] || 'var(--txt2)';
        var pct = Math.round(score * 100);
        result.classList.add('active');
        result.innerHTML =
          '<strong style="color:' + color + ';text-transform:capitalize">' + label + '</strong> (' + pct + '%)' + latencyBadge(ms, src) +
          '<div class="sentiment-bar"><div class="sentiment-fill" style="width:' + pct + '%;background:' + color + '"></div></div>';
        hideLoading(btn, 'Analizar');
      }).catch(function(err){
        showError(result, 'Error: ' + (err.message || err));
        hideLoading(btn, 'Analizar');
      });
    });
  });

  /* ‚îÄ‚îÄ 2. Clasificacion ‚îÄ‚îÄ */
  $('clasificacion-btn').addEventListener('click', function(){
    var btn = this;
    var input = $('clasificacion-input').value.trim();
    var result = $('clasificacion-result');
    if(!input){ result.textContent = 'Por favor escribe un texto para clasificar.'; return; }
    showLoading(btn);
    result.innerHTML = '<span class="spinner"></span> Clasificando...';
    ensureAI(function(ai){
      var t0 = performance.now();
      ai.classify(input).then(function(res){
        var ms = Math.round(performance.now() - t0);
        var src = res.source || 'local';
        var cats = res.categories || res.labels || [];
        if(!Array.isArray(cats)) cats = [cats];
        cats = cats.slice(0, 3);
        var html = '<strong>Top categor&iacute;as:</strong>' + latencyBadge(ms, src) + '<ul style="list-style:none;margin-top:.5rem">';
        cats.forEach(function(c, i){
          var name = c.label || c.name || c;
          var score = typeof c.score === 'number' ? ' (' + Math.round(c.score * 100) + '%)' : '';
          var opacity = 1 - (i * 0.2);
          html += '<li style="padding:.3rem 0;opacity:' + opacity + '"><span style="color:var(--accent);font-weight:700">#' + (i+1) + '</span> ' + name + '<span style="color:var(--txt2)">' + score + '</span></li>';
        });
        html += '</ul>';
        result.classList.add('active');
        result.innerHTML = html;
        hideLoading(btn, 'Clasificar');
      }).catch(function(err){
        showError(result, 'Error: ' + (err.message || err));
        hideLoading(btn, 'Clasificar');
      });
    });
  });

  /* ‚îÄ‚îÄ 3. Traduccion ‚îÄ‚îÄ */
  var srcLang = 'es', tgtLang = 'en';

  $('traduccion-swap').addEventListener('click', function(){
    var tmp = srcLang; srcLang = tgtLang; tgtLang = tmp;
    var srcEl = $('traduccion-src');
    var tgtEl = $('traduccion-tgt');
    var srcLabel = srcEl.parentElement.querySelector('.demo-label');
    var tgtLabel = tgtEl.parentElement.querySelector('.demo-label');
    srcLabel.textContent = srcLang === 'es' ? 'Espa\u00f1ol' : 'Ingl\u00e9s';
    tgtLabel.textContent = tgtLang === 'en' ? 'Ingl\u00e9s' : 'Espa\u00f1ol';
    var tmpVal = srcEl.value;
    srcEl.value = tgtEl.value;
    tgtEl.value = tmpVal;
  });

  $('traduccion-btn').addEventListener('click', function(){
    var btn = this;
    var input = $('traduccion-src').value.trim();
    var tgtEl = $('traduccion-tgt');
    var result = $('traduccion-result');
    if(!input){ tgtEl.value = ''; result.style.display = 'block'; result.textContent = 'Por favor escribe un texto para traducir.'; return; }
    showLoading(btn);
    tgtEl.value = 'Traduciendo...';
    ensureAI(function(ai){
      var t0 = performance.now();
      ai.translate(input, { from: srcLang, to: tgtLang }).then(function(res){
        var ms = Math.round(performance.now() - t0);
        var src = res.source || 'local';
        tgtEl.value = res.text || res.translation || '';
        result.style.display = 'block';
        result.classList.add('active');
        result.innerHTML = '<span style="color:var(--accent)">Traducido</span> ' + srcLang.toUpperCase() + ' &rarr; ' + tgtLang.toUpperCase() + latencyBadge(ms, src);
        hideLoading(btn, 'Traducir');
      }).catch(function(err){
        tgtEl.value = '';
        result.style.display = 'block';
        showError(result, 'Error: ' + (err.message || err));
        hideLoading(btn, 'Traducir');
      });
    });
  });

  /* ‚îÄ‚îÄ 4. NER ‚îÄ‚îÄ */
  $('ner-btn').addEventListener('click', function(){
    var btn = this;
    var input = $('ner-input').value.trim();
    var result = $('ner-result');
    if(!input){ result.innerHTML = 'Por favor escribe un texto con entidades.'; return; }
    showLoading(btn);
    result.innerHTML = '<span class="spinner"></span> Detectando entidades...';
    ensureAI(function(ai){
      var t0 = performance.now();
      ai.ner(input).then(function(res){
        var ms = Math.round(performance.now() - t0);
        var src = res.source || 'local';
        var entities = res.entities || [];
        var legend = '<div style="margin-bottom:.5rem;font-size:.75rem;color:var(--txt2)">' +
          '<span class="ner-entity ner-PER">PER</span> Persona ' +
          '<span class="ner-entity ner-ORG" style="margin-left:.5rem">ORG</span> Organizaci\u00f3n ' +
          '<span class="ner-entity ner-LOC" style="margin-left:.5rem">LOC</span> Ubicaci\u00f3n' +
          '</div>';
        if(!entities.length){
          result.classList.add('active');
          result.innerHTML = legend + '<span style="color:var(--txt2)">No se detectaron entidades.</span>' + latencyBadge(ms, src);
          hideLoading(btn, 'Detectar');
          return;
        }
        /* Build highlighted text */
        var sorted = entities.slice().sort(function(a,b){ return (a.start||0) - (b.start||0); });
        var highlighted = '';
        var last = 0;
        sorted.forEach(function(e){
          var s = e.start != null ? e.start : input.indexOf(e.word || e.text || '');
          var word = e.word || e.text || '';
          var end = e.end != null ? e.end : s + word.length;
          var type = (e.entity || e.label || e.type || 'PER').replace(/^B-|^I-/, '').toUpperCase();
          if(!['PER','ORG','LOC'].includes(type)) type = 'PER';
          if(s > last) highlighted += escapeHtml(input.substring(last, s));
          highlighted += '<span class="ner-entity ner-' + type + '">' + escapeHtml(word || input.substring(s, end)) + '</span>';
          last = end;
        });
        if(last < input.length) highlighted += escapeHtml(input.substring(last));
        result.classList.add('active');
        result.innerHTML = legend + '<div style="line-height:2">' + highlighted + '</div>' + latencyBadge(ms, src);
        hideLoading(btn, 'Detectar');
      }).catch(function(err){
        showError(result, 'Error: ' + (err.message || err));
        hideLoading(btn, 'Detectar');
      });
    });
  });

  function escapeHtml(s){
    var d = document.createElement('div');
    d.textContent = s;
    return d.innerHTML;
  }

  /* ‚îÄ‚îÄ 5. Imagen ‚îÄ‚îÄ */
  var dropzone = $('imagen-dropzone');
  var fileInput = $('imagen-file');
  var imgResult = $('imagen-result');

  ['dragenter','dragover'].forEach(function(ev){
    dropzone.addEventListener(ev, function(e){ e.preventDefault(); dropzone.classList.add('dragover'); });
  });
  ['dragleave','drop'].forEach(function(ev){
    dropzone.addEventListener(ev, function(e){ e.preventDefault(); dropzone.classList.remove('dragover'); });
  });

  dropzone.addEventListener('drop', function(e){
    var files = e.dataTransfer.files;
    if(files.length) handleImage(files[0]);
  });

  fileInput.addEventListener('change', function(){
    if(this.files.length) handleImage(this.files[0]);
  });

  function handleImage(file){
    if(!file.type.startsWith('image/')){ imgResult.textContent = 'Por favor selecciona una imagen v\u00e1lida.'; return; }
    var reader = new FileReader();
    reader.onload = function(e){
      dropzone.innerHTML = '<img src="' + e.target.result + '" alt="Imagen seleccionada">';
      imgResult.innerHTML = '<span class="spinner"></span> Clasificando imagen...';
      ensureAI(function(ai){
        var t0 = performance.now();
        ai.classifyImage(file).then(function(res){
          var ms = Math.round(performance.now() - t0);
          var src = res.source || 'local';
          var preds = res.predictions || res.labels || [];
          if(!Array.isArray(preds)) preds = [preds];
          preds = preds.slice(0, 5);
          var html = '<strong>Top 5 predicciones:</strong>' + latencyBadge(ms, src) + '<ul style="list-style:none;margin-top:.5rem">';
          preds.forEach(function(p, i){
            var name = p.label || p.className || p;
            var score = typeof p.score === 'number' ? Math.round(p.score * 100) : null;
            var barW = score != null ? score : (100 - i * 18);
            html += '<li style="padding:.25rem 0;display:flex;align-items:center;gap:.5rem">' +
              '<span style="color:var(--accent);font-weight:700;width:1.5rem">#' + (i+1) + '</span>' +
              '<span style="flex:1">' + name + '</span>' +
              (score != null ? '<span style="color:var(--txt2);font-size:.8rem">' + score + '%</span>' : '') +
              '<div style="width:60px;height:6px;background:var(--bg4);border-radius:3px;overflow:hidden"><div style="width:' + barW + '%;height:100%;background:var(--accent);border-radius:3px"></div></div>' +
              '</li>';
          });
          html += '</ul>';
          imgResult.classList.add('active');
          imgResult.innerHTML = html;
        }).catch(function(err){
          showError(imgResult, 'Error: ' + (err.message || err));
        });
      });
    };
    reader.readAsDataURL(file);
  }

  /* ‚îÄ‚îÄ 6. Embeddings ‚îÄ‚îÄ */
  $('embed-btn').addEventListener('click', function(){
    var btn = this;
    var a = $('embed-a').value.trim();
    var b = $('embed-b').value.trim();
    var result = $('embed-result');
    var scoreEl = $('embed-score');
    var gaugeEl = $('embed-gauge');
    if(!a || !b){ scoreEl.textContent = '--'; gaugeEl.style.width = '0%'; return; }
    showLoading(btn);
    scoreEl.innerHTML = '<span class="spinner"></span>';
    ensureAI(function(ai){
      var t0 = performance.now();
      ai.embeddings(a, b).then(function(res){
        var ms = Math.round(performance.now() - t0);
        var src = res.source || 'local';
        var sim = typeof res.similarity === 'number' ? res.similarity : (typeof res.score === 'number' ? res.score : 0);
        var pct = Math.round(sim * 100);
        scoreEl.textContent = sim.toFixed(4);
        gaugeEl.style.width = pct + '%';
        result.classList.add('active');
        var badge = document.createElement('div');
        badge.style.textAlign = 'center';
        badge.style.marginTop = '.25rem';
        badge.innerHTML = latencyBadge(ms, src);
        /* Remove old badge if any */
        var oldBadge = result.querySelector('.latency-container');
        if(oldBadge) oldBadge.remove();
        badge.className = 'latency-container';
        result.appendChild(badge);
        hideLoading(btn, 'Comparar');
      }).catch(function(err){
        scoreEl.textContent = 'Error';
        gaugeEl.style.width = '0%';
        showError(result, 'Error: ' + (err.message || err));
        hideLoading(btn, 'Comparar');
      });
    });
  });

  /* ‚îÄ‚îÄ Status panel ‚îÄ‚îÄ */
  function updateStatus(){
    /* Backend detection */
    var backendEl = $('status-backend');
    if(typeof WebGPUComputePipeline !== 'undefined' || (navigator.gpu)){
      backendEl.textContent = 'WebGPU';
      backendEl.title = 'Hardware-accelerated AI inference via WebGPU';
    } else if(typeof WebAssembly === 'object' && typeof WebAssembly.validate === 'function'){
      /* Check SIMD support */
      try {
        var simdTest = new Uint8Array([0,97,115,109,1,0,0,0,1,5,1,96,0,1,123,3,2,1,0,10,10,1,8,0,65,0,253,15,253,98,11]);
        if(WebAssembly.validate(simdTest)){
          backendEl.textContent = 'WASM-SIMD';
          backendEl.title = 'WebAssembly with SIMD acceleration';
        } else {
          backendEl.textContent = 'WASM';
          backendEl.title = 'WebAssembly without SIMD';
        }
      } catch(e){
        backendEl.textContent = 'WASM';
      }
    } else {
      backendEl.textContent = 'No soportado';
      backendEl.style.color = '#ff6b6b';
    }

    /* Connectivity */
    var dot = $('status-dot');
    var txt = $('status-online-text');
    function setConnectivity(){
      var online = navigator.onLine;
      dot.className = 'status-indicator ' + (online ? 'status-online' : 'status-offline');
      txt.textContent = online ? 'Online' : 'Offline';
    }
    setConnectivity();
    window.addEventListener('online', setConnectivity);
    window.addEventListener('offline', setConnectivity);

    /* Model info from AI engine */
    if(AI && typeof AI.getStatus === 'function'){
      AI.getStatus().then(function(status){
        if(status.cachedModels != null) $('status-models').textContent = status.cachedModels + ' / 7';
        if(status.storageMB != null) $('status-storage').textContent = status.storageMB.toFixed(1) + ' MB';
      }).catch(function(){});
    }

    /* Storage estimate */
    if(navigator.storage && navigator.storage.estimate){
      navigator.storage.estimate().then(function(est){
        if(est.usage){
          $('status-storage').textContent = (est.usage / (1024 * 1024)).toFixed(1) + ' MB';
        }
      }).catch(function(){});
    }
  }

  /* Download all models */
  $('download-all-btn').addEventListener('click', function(){
    var btn = this;
    var btnText = btn.querySelector('.btn-text');
    if(!AI || typeof AI.downloadAllModels !== 'function'){
      btnText.textContent = 'IerahkwaAI no disponible';
      setTimeout(function(){ btnText.innerHTML = '<span aria-hidden="true">\u2B07</span> Descargar todos los modelos'; }, 3000);
      return;
    }
    btn.disabled = true;
    btnText.innerHTML = '<span class="spinner"></span> Descargando modelos...';
    AI.downloadAllModels({
      onProgress: function(done, total){
        btnText.innerHTML = '<span class="spinner"></span> Descargando ' + done + '/' + total + '...';
      }
    }).then(function(result){
      btnText.innerHTML = '<span aria-hidden="true">\u2705</span> Todos los modelos descargados';
      btn.disabled = false;
      if(result && result.cachedModels != null){
        $('status-models').textContent = result.cachedModels + ' / 7';
      }
      updateStatus();
    }).catch(function(err){
      btnText.innerHTML = '<span style="color:#ff6b6b">Error: ' + (err.message || 'Descarga fallida') + '</span>';
      btn.disabled = false;
      setTimeout(function(){ btnText.innerHTML = '<span aria-hidden="true">\u2B07</span> Descargar todos los modelos'; }, 4000);
    });
  });

  /* Init */
  if(document.readyState === 'loading'){
    document.addEventListener('DOMContentLoaded', updateStatus);
  } else {
    updateStatus();
  }

})();
</script>
<script src="../shared/ierahkwa-security.js"></script>
<script src="../shared/ierahkwa-quantum.js"></script>
<script src="../shared/ierahkwa-protocols.js"></script>
<script src="../shared/ierahkwa-interconnect.js"></script>
<script>if("serviceWorker"in navigator){navigator.serviceWorker.register("../shared/sw.js").catch(function(){})}</script>
</body>
</html>