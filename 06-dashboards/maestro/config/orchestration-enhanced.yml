# Enhanced Orchestration Config with Subagent-like Capabilities
# This demonstrates nested workflows, parallel execution, and dynamic task spawning

roles:
  Architect:
    name: Architect
    description: System design, architecture decisions, DDD patterns, microservice design
    promptHints: |
      You are an expert software architect specializing in the Mamey Framework.
      Focus on:
      - Domain-Driven Design (DDD) patterns
      - CQRS architecture
      - Event-driven microservices
      - Service boundaries and contracts
      - Scalability and maintainability
    defaultFilePatterns:
      - "**/*.md"
      - "**/TDD*.md"
      - "**/designs/**/*.md"
    domainKnowledge:
      - Government
      - Banking
      - FutureWampum

  Backend:
    name: Backend
    description: .NET microservice implementation, CQRS, domain logic, handlers
    promptHints: |
      You are a backend developer specializing in .NET microservices using the Mamey Framework.
      Focus on:
      - CQRS command/query handlers
      - Domain entities and aggregates
      - Event handlers
      - Repository patterns
      - Following Mamey.TemplateEngine patterns
    defaultFilePatterns:
      - "**/*.cs"
      - "**/Application/**"
      - "**/Domain/**"
    defaultDirectories:
      - "src"
      - "Application"
      - "Domain"

  Frontend:
    name: Frontend
    description: Blazor/Razor components, UI/UX implementation, client-side logic
    promptHints: |
      You are a frontend developer specializing in Blazor and Razor components.
      Focus on:
      - Blazor Server and Blazor WebAssembly
      - Razor component architecture
      - UI/UX best practices
      - Client-side state management
    defaultFilePatterns:
      - "**/*.razor"
      - "**/*.cshtml"
      - "**/Blazor/**"
    defaultDirectories:
      - "Components"
      - "Pages"

  Tests:
    name: Tests
    description: Unit, integration, and E2E tests, test coverage
    promptHints: |
      You are a test engineer specializing in comprehensive test coverage.
      Focus on:
      - Unit tests for domain logic
      - Integration tests for services
      - E2E tests for workflows
      - Test data builders
    defaultFilePatterns:
      - "**/*.Tests/**"
      - "**/*Test*.cs"
    defaultDirectories:
      - "tests"
      - "Tests"

  Contracts:
    name: Contracts
    description: API contracts, DTOs, shared interfaces, message definitions
    promptHints: |
      You are a contracts specialist focusing on API design and message contracts.
      Focus on:
      - API contracts and DTOs
      - Shared interfaces
      - Message definitions
      - Contract versioning
    defaultFilePatterns:
      - "**/Contracts/**"
      - "**/*Contract*.cs"
      - "**/*Dto*.cs"
    defaultDirectories:
      - "Contracts"
      - "Shared"

flows:
  # Example: Nested workflow for backend implementation
  backend_implementation:
    name: backend_implementation
    description: Backend implementation with nested domain and infrastructure workflows
    steps:
      - name: DomainImplementation
        agent: Backend
        description: Implement domain layer
        dependsOn: []
        nestedWorkflow: domain_layer_workflow  # Nested workflow

      - name: InfrastructureImplementation
        agent: Backend
        description: Implement infrastructure layer
        dependsOn:
          - DomainImplementation
        nestedWorkflow: infrastructure_layer_workflow  # Nested workflow

  # Nested workflow: Domain layer
  domain_layer_workflow:
    name: domain_layer_workflow
    description: Domain layer implementation workflow
    steps:
      - name: Entities
        agent: Backend
        description: Create domain entities
        dependsOn: []
        parallel: true  # Can run in parallel with ValueObjects

      - name: ValueObjects
        agent: Backend
        description: Create value objects
        dependsOn: []
        parallel: true  # Can run in parallel with Entities

      - name: DomainEvents
        agent: Backend
        description: Define domain events
        dependsOn:
          - Entities
          - ValueObjects

  # Nested workflow: Infrastructure layer
  infrastructure_layer_workflow:
    name: infrastructure_layer_workflow
    description: Infrastructure layer implementation workflow
    steps:
      - name: Repositories
        agent: Backend
        description: Implement repositories
        dependsOn: []
        parallel: true

      - name: ExternalServices
        agent: Backend
        description: Implement external service integrations
        dependsOn: []
        parallel: true

      - name: Configuration
        agent: Backend
        description: Configure infrastructure
        dependsOn:
          - Repositories
          - ExternalServices

  # Example: Parallel execution workflow
  parallel_feature_implementation:
    name: parallel_feature_implementation
    description: Feature implementation with parallel execution
    steps:
      - name: ArchitecturePlan
        agent: Architect
        description: Analyze requirements and propose architecture
        dependsOn: []

      # These three can run in parallel (no dependencies on each other)
      - name: BackendImplementation
        agent: Backend
        description: Implement backend logic & contracts
        dependsOn:
          - ArchitecturePlan
        parallel: true  # Explicitly mark for parallel execution

      - name: Contracts
        agent: Contracts
        description: Define API contracts, DTOs, and shared interfaces
        dependsOn:
          - ArchitecturePlan
        parallel: true  # Explicitly mark for parallel execution

      - name: DatabaseSchema
        agent: Backend
        description: Design database schema
        dependsOn:
          - ArchitecturePlan
        parallel: true  # Explicitly mark for parallel execution

      # Frontend waits for all three parallel tasks
      - name: FrontendImplementation
        agent: Frontend
        description: Implement UI and integration
        dependsOn:
          - BackendImplementation
          - Contracts
          - DatabaseSchema

      # Tests can run in parallel after frontend
      - name: UnitTests
        agent: Tests
        description: Write unit tests
        dependsOn:
          - BackendImplementation
        parallel: true

      - name: IntegrationTests
        agent: Tests
        description: Write integration tests
        dependsOn:
          - BackendImplementation
        parallel: true

      - name: E2ETests
        agent: Tests
        description: Write end-to-end tests
        dependsOn:
          - FrontendImplementation
        parallel: true

  # Example: Dynamic task spawning
  feature_with_spawned_tasks:
    name: feature_with_spawned_tasks
    description: Feature implementation with dynamic task spawning
    steps:
      - name: BackendImplementation
        agent: Backend
        description: Implement backend logic
        dependsOn: []
        # Spawn sub-tasks conditionally
        spawnTasks:
          - condition: "previousResult.success === true"
            agent: Tests
            description: Create unit tests for backend implementation
          - condition: "previousResult.success === true"
            agent: Contracts
            description: Verify API contracts match implementation

      - name: FrontendImplementation
        agent: Frontend
        description: Implement frontend
        dependsOn:
          - BackendImplementation
        spawnTasks:
          - condition: "previousResult.success === true"
            agent: Tests
            description: Create E2E tests for frontend

  # Complete feature implementation with all capabilities
  feature_implementation_enhanced:
    name: feature_implementation_enhanced
    description: Complete feature implementation with nested workflows, parallel execution, and spawning
    steps:
      - name: ArchitecturePlan
        agent: Architect
        description: Analyze requirements and propose architecture & changes
        dependsOn: []

      # Parallel backend tasks
      - name: BackendCore
        agent: Backend
        description: Implement core backend logic
        dependsOn:
          - ArchitecturePlan
        parallel: true
        nestedWorkflow: backend_implementation  # Use nested workflow

      - name: Contracts
        agent: Contracts
        description: Define API contracts, DTOs, and shared interfaces
        dependsOn:
          - ArchitecturePlan
        parallel: true

      # Frontend after parallel tasks complete
      - name: FrontendImplementation
        agent: Frontend
        description: Implement UI and integration
        dependsOn:
          - BackendCore
          - Contracts
        spawnTasks:
          - condition: "previousResult.success === true"
            agent: Tests
            description: Create frontend component tests

      # Parallel test execution
      - name: BackendTests
        agent: Tests
        description: Add backend tests
        dependsOn:
          - BackendCore
        parallel: true

      - name: IntegrationTests
        agent: Tests
        description: Add integration tests
        dependsOn:
          - BackendCore
        parallel: true
