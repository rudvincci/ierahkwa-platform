name: Accessibility Check

on:
  pull_request:
    paths:
      - '02-plataformas-html/**'
      - '03-backend/shared/accessibility.js'

jobs:
  a11y-check:
    name: WCAG 2.2 AA Compliance
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - uses: actions/setup-node@v4
        with:
          node-version: '22'

      - name: Run Accessibility Audit
        run: node 04-infraestructura/accessibility/a11y-audit.js --report

      - name: Comment PR with Results
        uses: actions/github-script@v7
        with:
          script: |
            const fs = require('fs');
            const report = fs.readFileSync('ACCESSIBILITY-REPORT.md', 'utf-8');
            const summary = report.split('## Platforms Needing Attention')[0];

            github.rest.issues.createComment({
              issue_number: context.issue.number,
              owner: context.repo.owner,
              repo: context.repo.repo,
              body: `## â™¿ Accessibility Audit Results\n\n${summary}\n\n*Full report available in workflow artifacts*`
            });

      - name: Upload Full Report
        uses: actions/upload-artifact@v4
        with:
          name: a11y-report
          path: ACCESSIBILITY-REPORT.md
