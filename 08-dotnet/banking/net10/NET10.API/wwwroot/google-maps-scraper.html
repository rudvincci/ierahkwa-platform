<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üó∫Ô∏è Google Maps Data Scraper PRO | NET10</title>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;500;600;700;800;900&family=Exo+2:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.0/font/bootstrap-icons.css" rel="stylesheet">
    <style>
        :root {
            --gold: #FFD700;
            --neon-green: #00FF41;
            --neon-cyan: #00FFFF;
            --neon-purple: #9D4EDD;
            --neon-blue: #0066FF;
            --neon-red: #FF3366;
            --neon-orange: #FF6B35;
            --bg-dark: #0a0e17;
            --bg-card: #0d1a2d;
            --bg-input: #142238;
            --border: #1e3a5f;
        }
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Exo 2', sans-serif; background: var(--bg-dark); color: #fff; min-height: 100vh; }
        
        .header { background: linear-gradient(135deg, var(--neon-orange), var(--neon-red)); padding: 12px 30px; display: flex; justify-content: space-between; align-items: center; }
        .header-brand { display: flex; align-items: center; gap: 15px; }
        .brand-icon { width: 50px; height: 50px; background: rgba(255,255,255,0.2); border-radius: 12px; display: flex; align-items: center; justify-content: center; font-size: 1.8em; }
        .brand-text h1 { font-family: 'Orbitron', sans-serif; font-size: 1.4em; }
        .brand-text span { font-size: 0.8em; opacity: 0.9; }
        .header-actions { display: flex; gap: 15px; align-items: center; }
        .btn { padding: 10px 20px; border: none; border-radius: 8px; font-weight: 600; cursor: pointer; transition: all 0.3s; display: flex; align-items: center; gap: 8px; }
        .btn-white { background: #fff; color: var(--neon-orange); }
        .btn-dark { background: rgba(0,0,0,0.3); color: #fff; }
        .btn:hover { transform: translateY(-2px); }
        
        .main-layout { display: grid; grid-template-columns: 300px 1fr; min-height: calc(100vh - 70px); }
        
        .sidebar { background: var(--bg-card); border-right: 2px solid var(--neon-orange); padding: 20px 0; }
        .sidebar-section { margin-bottom: 20px; }
        .sidebar-title { font-size: 0.7em; color: #666; text-transform: uppercase; letter-spacing: 1px; padding: 0 20px 10px; }
        .nav-item { display: flex; align-items: center; gap: 12px; padding: 12px 20px; cursor: pointer; transition: all 0.3s; border-left: 3px solid transparent; color: #ccc; }
        .nav-item:hover { background: rgba(255, 107, 53, 0.1); color: var(--neon-orange); }
        .nav-item.active { background: rgba(255, 107, 53, 0.1); border-left-color: var(--neon-orange); color: var(--neon-orange); }
        .nav-item i { font-size: 1.1em; width: 24px; }
        
        .content { padding: 25px; overflow-y: auto; }
        .page-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 25px; }
        .page-title { font-family: 'Orbitron', sans-serif; font-size: 1.5em; color: var(--neon-orange); }
        
        .card { background: var(--bg-card); border: 2px solid var(--border); border-radius: 15px; overflow: hidden; margin-bottom: 20px; }
        .card-header { padding: 15px 20px; border-bottom: 1px solid var(--border); display: flex; justify-content: space-between; align-items: center; }
        .card-title { font-family: 'Orbitron', sans-serif; color: var(--gold); }
        .card-body { padding: 20px; }
        
        .form-row { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; }
        .form-group { margin-bottom: 15px; }
        .form-label { display: block; font-size: 0.85em; color: #888; margin-bottom: 8px; }
        .form-input, .form-select, .form-textarea { width: 100%; padding: 12px 15px; background: var(--bg-input); border: 2px solid var(--border); border-radius: 10px; color: #fff; font-size: 0.95em; font-family: 'Exo 2', sans-serif; }
        .form-input:focus, .form-select:focus, .form-textarea:focus { border-color: var(--neon-orange); outline: none; }
        .form-textarea { min-height: 100px; resize: vertical; }
        
        .btn-primary { background: linear-gradient(135deg, var(--neon-orange), var(--neon-red)); color: #fff; font-weight: 700; }
        .btn-secondary { background: var(--bg-input); border: 2px solid var(--border); color: #fff; }
        .btn-success { background: linear-gradient(135deg, var(--neon-green), #00cc33); color: #000; }
        .btn-danger { background: linear-gradient(135deg, var(--neon-red), #cc0022); color: #fff; }
        
        .panel { display: none; }
        .panel.active { display: block; }
        
        table { width: 100%; border-collapse: collapse; }
        th { background: var(--bg-input); padding: 12px 15px; text-align: left; font-size: 0.85em; color: #888; }
        td { padding: 15px; border-bottom: 1px solid var(--border); }
        tr:hover { background: rgba(255, 107, 53, 0.05); }
        
        .status-badge { padding: 4px 12px; border-radius: 15px; font-size: 0.8em; font-weight: 600; }
        .status-pending { background: rgba(255, 215, 0, 0.2); color: var(--gold); }
        .status-running { background: rgba(0, 255, 65, 0.2); color: var(--neon-green); }
        .status-paused { background: rgba(0, 102, 255, 0.2); color: var(--neon-blue); }
        .status-completed { background: rgba(0, 255, 65, 0.2); color: var(--neon-green); }
        .status-failed { background: rgba(255, 51, 102, 0.2); color: var(--neon-red); }
        .status-stopped { background: rgba(128, 128, 128, 0.2); color: #888; }
        
        .progress-bar { width: 100%; height: 20px; background: var(--bg-input); border-radius: 10px; overflow: hidden; margin: 10px 0; }
        .progress-fill { height: 100%; background: linear-gradient(90deg, var(--neon-orange), var(--neon-red)); transition: width 0.3s; display: flex; align-items: center; justify-content: center; color: #000; font-size: 0.75em; font-weight: 700; }
        
        .project-card { background: var(--bg-card); border: 2px solid var(--border); border-radius: 15px; padding: 20px; margin-bottom: 15px; transition: all 0.3s; }
        .project-card:hover { border-color: var(--neon-orange); transform: translateY(-3px); }
        .project-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; }
        .project-name { font-weight: 600; font-size: 1.1em; }
        .project-meta { font-size: 0.85em; color: #888; }
        
        .modal-overlay { display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.8); z-index: 1000; align-items: center; justify-content: center; }
        .modal-overlay.active { display: flex; }
        .modal { background: var(--bg-card); border: 2px solid var(--neon-orange); border-radius: 20px; padding: 30px; min-width: 500px; max-width: 90vw; max-height: 90vh; overflow-y: auto; }
        .modal-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; }
        .modal-title { font-family: 'Orbitron', sans-serif; color: var(--neon-orange); font-size: 1.3em; }
        .modal-close { background: none; border: none; color: #888; font-size: 1.5em; cursor: pointer; }
        
        .stats-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 20px; margin-bottom: 30px; }
        .stat-card { background: var(--bg-card); border: 2px solid var(--border); border-radius: 15px; padding: 20px; text-align: center; }
        .stat-value { font-family: 'Orbitron', sans-serif; font-size: 1.8em; color: var(--neon-cyan); }
        .stat-label { font-size: 0.85em; color: #888; margin-top: 5px; }
    </style>
</head>
<body>
    <header class="header">
        <div class="header-brand">
            <div class="brand-icon">üó∫Ô∏è</div>
            <div class="brand-text">
                <h1>Google Maps Scraper PRO</h1>
                <span>Professional Data Scraper for Google Maps</span>
            </div>
        </div>
        <div class="header-actions">
            <button class="btn btn-dark" onclick="location.href='/index.html'">
                <i class="bi bi-house"></i> Home
            </button>
            <button class="btn btn-white" onclick="loadProjects()">
                <i class="bi bi-arrow-clockwise"></i> Refresh
            </button>
        </div>
    </header>
    
    <div class="main-layout">
        <aside class="sidebar">
            <div class="sidebar-section">
                <div class="nav-item active" onclick="showPanel('projects')">
                    <i class="bi bi-folder"></i>
                    <span>Projects</span>
                </div>
                <div class="nav-item" onclick="showPanel('new-project')">
                    <i class="bi bi-plus-circle"></i>
                    <span>New Project</span>
                </div>
            </div>
            <div class="sidebar-section">
                <div class="sidebar-title">Actions</div>
                <div class="nav-item" onclick="showPanel('export')">
                    <i class="bi bi-download"></i>
                    <span>Export Data</span>
                </div>
                <div class="nav-item" onclick="showPanel('settings')">
                    <i class="bi bi-gear"></i>
                    <span>Settings</span>
                </div>
            </div>
        </aside>
        
        <main class="content">
            <!-- Projects Panel -->
            <div id="panel-projects" class="panel active">
                <div class="page-header">
                    <h2 class="page-title">Scraping Projects</h2>
                    <button class="btn btn-primary" onclick="showPanel('new-project')">
                        <i class="bi bi-plus"></i> New Project
                    </button>
                </div>
                
                <div id="projectsList"></div>
            </div>
            
            <!-- New Project Panel -->
            <div id="panel-new-project" class="panel">
                <div class="page-header">
                    <h2 class="page-title">Create New Project</h2>
                </div>
                
                <div class="card">
                    <div class="card-body">
                        <form id="newProjectForm">
                            <div class="form-group">
                                <label class="form-label">Project Name</label>
                                <input type="text" class="form-input" id="projectName" placeholder="My Scraping Project" required>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">Geo Locations (comma separated)</label>
                                <textarea class="form-textarea" id="geoLocations" placeholder="New York, Los Angeles, Chicago" required></textarea>
                                <small style="color: #888; font-size: 0.8em;">Enter cities, regions, or countries separated by commas</small>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">Keywords (comma separated)</label>
                                <textarea class="form-textarea" id="keywords" placeholder="restaurant, hotel, shop" required></textarea>
                                <small style="color: #888; font-size: 0.8em;">Enter search keywords separated by commas</small>
                            </div>
                            
                            <div class="card" style="margin-top: 20px;">
                                <div class="card-header">
                                    <span class="card-title">Settings</span>
                                </div>
                                <div class="card-body">
                                    <div class="form-row">
                                        <div class="form-group">
                                            <label class="form-label">Max Organizations</label>
                                            <input type="number" class="form-input" id="maxOrganizations" value="100" min="1">
                                        </div>
                                        <div class="form-group">
                                            <label class="form-label">Max per Segment</label>
                                            <input type="number" class="form-input" id="maxPerSegment" value="0" min="0">
                                            <small style="color: #888; font-size: 0.8em;">0 = unlimited</small>
                                        </div>
                                    </div>
                                    
                                    <div class="form-row">
                                        <div class="form-group">
                                            <label class="form-label">Min Rating</label>
                                            <input type="number" class="form-input" id="minRating" step="0.1" min="0" max="5">
                                        </div>
                                        <div class="form-group">
                                            <label class="form-label">Max Rating</label>
                                            <input type="number" class="form-input" id="maxRating" step="0.1" min="0" max="5">
                                        </div>
                                    </div>
                                    
                                    <div class="form-group">
                                        <label style="display: flex; align-items: center; gap: 10px; cursor: pointer;">
                                            <input type="checkbox" id="scrapeReviews" checked>
                                            <span>Scrape Reviews</span>
                                        </label>
                                    </div>
                                    
                                    <div class="form-group">
                                        <label style="display: flex; align-items: center; gap: 10px; cursor: pointer;">
                                            <input type="checkbox" id="scrapePhotos" checked>
                                            <span>Scrape Photos</span>
                                        </label>
                                    </div>
                                    
                                    <div class="form-group">
                                        <label style="display: flex; align-items: center; gap: 10px; cursor: pointer;">
                                            <input type="checkbox" id="scrapeWebsiteData" checked>
                                            <span>Scrape Website Data</span>
                                        </label>
                                    </div>
                                    
                                    <div class="form-group">
                                        <label style="display: flex; align-items: center; gap: 10px; cursor: pointer;">
                                            <input type="checkbox" id="skipDuplicates" checked>
                                            <span>Skip Duplicates</span>
                                        </label>
                                    </div>
                                </div>
                            </div>
                            
                            <button type="submit" class="btn btn-primary" style="width: 100%; margin-top: 20px;">
                                <i class="bi bi-play-circle"></i> Create & Start Project
                            </button>
                        </form>
                    </div>
                </div>
            </div>
            
            <!-- Project Details Panel -->
            <div id="panel-project-details" class="panel">
                <div class="page-header">
                    <h2 class="page-title" id="projectDetailsTitle">Project Details</h2>
                    <button class="btn btn-secondary" onclick="showPanel('projects')">
                        <i class="bi bi-arrow-left"></i> Back
                    </button>
                </div>
                
                <div class="stats-grid" id="projectStats"></div>
                
                <div class="card">
                    <div class="card-header">
                        <span class="card-title">Progress</span>
                    </div>
                    <div class="card-body">
                        <div class="progress-bar">
                            <div class="progress-fill" id="progressFill" style="width: 0%;">0%</div>
                        </div>
                        <div id="progressInfo" style="margin-top: 10px; font-size: 0.9em; color: #888;"></div>
                    </div>
                </div>
                
                <div class="card">
                    <div class="card-header">
                        <span class="card-title">Actions</span>
                    </div>
                    <div class="card-body" style="display: flex; gap: 10px;">
                        <button class="btn btn-success" id="btnStart" onclick="startProject()">
                            <i class="bi bi-play"></i> Start
                        </button>
                        <button class="btn btn-secondary" id="btnPause" onclick="pauseProject()">
                            <i class="bi bi-pause"></i> Pause
                        </button>
                        <button class="btn btn-danger" id="btnStop" onclick="stopProject()">
                            <i class="bi bi-stop"></i> Stop
                        </button>
                    </div>
                </div>
                
                <div class="card">
                    <div class="card-header">
                        <span class="card-title">Scraped Organizations</span>
                    </div>
                    <div class="card-body">
                        <table id="organizationsTable">
                            <thead>
                                <tr>
                                    <th>Name</th>
                                    <th>Category</th>
                                    <th>Rating</th>
                                    <th>Reviews</th>
                                    <th>Address</th>
                                    <th>Phone</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody></tbody>
                        </table>
                    </div>
                </div>
            </div>
            
            <!-- Export Panel -->
            <div id="panel-export" class="panel">
                <div class="page-header">
                    <h2 class="page-title">Export Data</h2>
                </div>
                
                <div class="card">
                    <div class="card-header">
                        <span class="card-title">Select Project</span>
                    </div>
                    <div class="card-body">
                        <div class="form-group">
                            <label class="form-label">Project</label>
                            <select class="form-select" id="exportProject"></select>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">Export Format</label>
                            <select class="form-select" id="exportFormat">
                                <option value="xlsx">XLSX (Excel)</option>
                                <option value="csv">CSV</option>
                                <option value="json">JSON</option>
                                <option value="xml">XML</option>
                                <option value="mysql">MySQL</option>
                            </select>
                        </div>
                        
                        <div class="form-group" id="mysqlSettings" style="display: none;">
                            <label class="form-label">MySQL Connection String</label>
                            <input type="text" class="form-input" id="mysqlConnection" placeholder="Server=localhost;Database=scraper;User=root;Password=...">
                        </div>
                        
                        <button class="btn btn-primary" style="width: 100%;" onclick="exportData()">
                            <i class="bi bi-download"></i> Export
                        </button>
                    </div>
                </div>
            </div>
        </main>
    </div>
    
    <script>
        const API_BASE = window.location.origin + '/api/googlemapsscraper';
        let currentProjectId = null;
        let progressInterval = null;
        
        // Navigation
        function showPanel(panelId) {
            document.querySelectorAll('.panel').forEach(p => p.classList.remove('active'));
            document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
            document.getElementById('panel-' + panelId).classList.add('active');
            if (event?.target?.closest('.nav-item')) {
                event.target.closest('.nav-item').classList.add('active');
            }
            
            if (panelId === 'projects') loadProjects();
            else if (panelId === 'new-project') {
                document.getElementById('newProjectForm').reset();
            }
        }
        
        // Load Projects
        async function loadProjects() {
            try {
                const res = await fetch(API_BASE + '/projects');
                const projects = await res.json();
                
                const html = projects.map(p => `
                    <div class="project-card" onclick="viewProject('${p.id}')">
                        <div class="project-header">
                            <div>
                                <div class="project-name">${p.name}</div>
                                <div class="project-meta">
                                    ${p.geoLocations.join(', ')} ‚Ä¢ ${p.keywords.join(', ')}
                                </div>
                            </div>
                            <span class="status-badge status-${p.status.toLowerCase()}">${p.status}</span>
                        </div>
                        <div style="display: flex; justify-content: space-between; margin-top: 10px; font-size: 0.9em;">
                            <span style="color: #888;">Organizations: ${p.progress.scrapedOrganizations}/${p.progress.totalOrganizations}</span>
                            <span style="color: #888;">Progress: ${p.progress.progressPercent.toFixed(1)}%</span>
                        </div>
                    </div>
                `).join('');
                
                document.getElementById('projectsList').innerHTML = html || '<div style="text-align: center; padding: 40px; color: #888;">No projects yet. Create a new project to start.</div>';
                
                // Populate export project select
                const exportSelect = document.getElementById('exportProject');
                exportSelect.innerHTML = '<option value="">Select project...</option>' + 
                    projects.map(p => `<option value="${p.id}">${p.name}</option>`).join('');
            } catch (error) {
                console.error('Error loading projects:', error);
            }
        }
        
        // View Project
        async function viewProject(projectId) {
            currentProjectId = projectId;
            showPanel('project-details');
            
            try {
                const res = await fetch(API_BASE + '/projects/' + projectId);
                const project = await res.json();
                
                document.getElementById('projectDetailsTitle').textContent = project.name;
                
                // Stats
                document.getElementById('projectStats').innerHTML = `
                    <div class="stat-card">
                        <div class="stat-value">${project.progress.scrapedOrganizations}</div>
                        <div class="stat-label">Organizations</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value">${project.progress.scrapedReviews}</div>
                        <div class="stat-label">Reviews</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value">${project.progress.downloadedPhotos}</div>
                        <div class="stat-label">Photos</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value">${project.progress.progressPercent.toFixed(1)}%</div>
                        <div class="stat-label">Progress</div>
                    </div>
                `;
                
                // Progress bar
                document.getElementById('progressFill').style.width = project.progress.progressPercent + '%';
                document.getElementById('progressFill').textContent = project.progress.progressPercent.toFixed(1) + '%';
                document.getElementById('progressInfo').textContent = project.progress.currentAction || 'Ready';
                
                // Action buttons
                const btnStart = document.getElementById('btnStart');
                const btnPause = document.getElementById('btnPause');
                const btnStop = document.getElementById('btnStop');
                
                btnStart.style.display = project.status === 'Pending' || project.status === 'Stopped' || project.status === 'Failed' ? 'flex' : 'none';
                btnPause.style.display = project.status === 'Running' ? 'flex' : 'none';
                btnStop.style.display = project.status === 'Running' || project.status === 'Paused' ? 'flex' : 'none';
                
                // Load organizations
                await loadOrganizations(projectId);
                
                // Start progress polling if running
                if (project.status === 'Running') {
                    startProgressPolling(projectId);
                } else {
                    stopProgressPolling();
                }
            } catch (error) {
                console.error('Error loading project:', error);
            }
        }
        
        // Load Organizations
        async function loadOrganizations(projectId) {
            try {
                const res = await fetch(API_BASE + '/projects/' + projectId + '/organizations');
                const orgs = await res.json();
                
                const tbody = document.querySelector('#organizationsTable tbody');
                tbody.innerHTML = orgs.map(o => `
                    <tr>
                        <td><strong>${o.name}</strong></td>
                        <td>${o.category || '-'}</td>
                        <td>${o.rating ? '‚≠ê ' + o.rating.toFixed(1) : '-'}</td>
                        <td>${o.reviewCount || 0}</td>
                        <td>${o.address || '-'}</td>
                        <td>${o.phone || '-'}</td>
                        <td>
                            <button class="btn btn-secondary" style="padding: 5px 10px; font-size: 0.85em;" onclick="viewOrganization('${o.id}')">
                                View
                            </button>
                        </td>
                    </tr>
                `).join('');
            } catch (error) {
                console.error('Error loading organizations:', error);
            }
        }
        
        // Create Project
        document.getElementById('newProjectForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const geoLocations = document.getElementById('geoLocations').value.split(',').map(s => s.trim()).filter(s => s);
            const keywords = document.getElementById('keywords').value.split(',').map(s => s.trim()).filter(s => s);
            
            const settings = {
                maxOrganizations: parseInt(document.getElementById('maxOrganizations').value) || 100,
                maxOrganizationsPerSegment: parseInt(document.getElementById('maxPerSegment').value) || 0,
                scrapeReviews: document.getElementById('scrapeReviews').checked,
                scrapePhotos: document.getElementById('scrapePhotos').checked,
                scrapeWebsiteData: document.getElementById('scrapeWebsiteData').checked,
                skipDuplicates: document.getElementById('skipDuplicates').checked,
                minRating: document.getElementById('minRating').value ? parseFloat(document.getElementById('minRating').value) : null,
                maxRating: document.getElementById('maxRating').value ? parseFloat(document.getElementById('maxRating').value) : null
            };
            
            try {
                const res = await fetch(API_BASE + '/projects', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        name: document.getElementById('projectName').value,
                        geoLocations: geoLocations,
                        keywords: keywords,
                        settings: settings
                    })
                });
                
                if (res.ok) {
                    const project = await res.json();
                    await startProject(project.id);
                    viewProject(project.id);
                }
            } catch (error) {
                console.error('Error creating project:', error);
                alert('Error creating project: ' + error.message);
            }
        });
        
        // Project Actions
        async function startProject(projectId = currentProjectId) {
            try {
                const res = await fetch(API_BASE + '/projects/' + projectId + '/start', { method: 'POST' });
                if (res.ok) {
                    startProgressPolling(projectId);
                    viewProject(projectId);
                }
            } catch (error) {
                console.error('Error starting project:', error);
            }
        }
        
        async function pauseProject() {
            try {
                const res = await fetch(API_BASE + '/projects/' + currentProjectId + '/pause', { method: 'POST' });
                if (res.ok) {
                    viewProject(currentProjectId);
                }
            } catch (error) {
                console.error('Error pausing project:', error);
            }
        }
        
        async function stopProject() {
            try {
                const res = await fetch(API_BASE + '/projects/' + currentProjectId + '/stop', { method: 'POST' });
                if (res.ok) {
                    stopProgressPolling();
                    viewProject(currentProjectId);
                }
            } catch (error) {
                console.error('Error stopping project:', error);
            }
        }
        
        // Progress Polling
        function startProgressPolling(projectId) {
            stopProgressPolling();
            progressInterval = setInterval(async () => {
                try {
                    const res = await fetch(API_BASE + '/projects/' + projectId + '/progress');
                    const progress = await res.json();
                    
                    document.getElementById('progressFill').style.width = progress.progressPercent + '%';
                    document.getElementById('progressFill').textContent = progress.progressPercent.toFixed(1) + '%';
                    document.getElementById('progressInfo').textContent = progress.currentAction || 'Processing...';
                    
                    // Reload project if status changed
                    const projectRes = await fetch(API_BASE + '/projects/' + projectId);
                    const project = await projectRes.json();
                    if (project.status !== 'Running') {
                        stopProgressPolling();
                        viewProject(projectId);
                    }
                } catch (error) {
                    console.error('Error polling progress:', error);
                }
            }, 2000);
        }
        
        function stopProgressPolling() {
            if (progressInterval) {
                clearInterval(progressInterval);
                progressInterval = null;
            }
        }
        
        // Export
        document.getElementById('exportFormat').addEventListener('change', (e) => {
            document.getElementById('mysqlSettings').style.display = e.target.value === 'mysql' ? 'block' : 'none';
        });
        
        async function exportData() {
            const projectId = document.getElementById('exportProject').value;
            const format = document.getElementById('exportFormat').value;
            
            if (!projectId) {
                alert('Please select a project');
                return;
            }
            
            try {
                let res;
                if (format === 'mysql') {
                    const connectionString = document.getElementById('mysqlConnection').value;
                    if (!connectionString) {
                        alert('Please enter MySQL connection string');
                        return;
                    }
                    res = await fetch(API_BASE + '/projects/' + projectId + '/export/mysql', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ connectionString: connectionString })
                    });
                } else {
                    res = await fetch(API_BASE + '/projects/' + projectId + '/export/' + format, { method: 'POST' });
                }
                
                if (res.ok) {
                    const result = await res.json();
                    alert(`Export completed!\n\nOrganizations: ${result.organizationsExported}\nReviews: ${result.reviewsExported}\nPhotos: ${result.photosExported}\n\nFile: ${result.filePath || 'Database'}`);
                }
            } catch (error) {
                console.error('Error exporting:', error);
                alert('Error exporting: ' + error.message);
            }
        }
        
        function viewOrganization(orgId) {
            alert('Organization details view - Coming soon!');
        }
        
        // Initialize
        loadProjects();
    </script>
</body>
</html>
