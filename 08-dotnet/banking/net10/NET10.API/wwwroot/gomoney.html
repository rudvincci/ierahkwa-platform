<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ðŸ’° GoMoney | Personal Finance Management | NET10</title>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;500;600;700;800;900&family=Exo+2:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.0/font/bootstrap-icons.css" rel="stylesheet">
    <style>
        :root {
            --gold: #FFD700;
            --neon-green: #00FF41;
            --neon-cyan: #00FFFF;
            --neon-purple: #9D4EDD;
            --neon-blue: #0066FF;
            --neon-red: #FF3366;
            --neon-orange: #FF6B35;
            --bg-dark: #0a0e17;
            --bg-card: #0d1a2d;
            --bg-input: #142238;
            --border: #1e3a5f;
        }
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Exo 2', sans-serif; background: var(--bg-dark); color: #fff; min-height: 100vh; }
        
        .header { background: linear-gradient(135deg, var(--neon-green), var(--neon-cyan)); padding: 12px 30px; display: flex; justify-content: space-between; align-items: center; }
        .header-brand { display: flex; align-items: center; gap: 15px; }
        .brand-icon { width: 50px; height: 50px; background: rgba(255,255,255,0.2); border-radius: 12px; display: flex; align-items: center; justify-content: center; font-size: 1.8em; }
        .brand-text h1 { font-family: 'Orbitron', sans-serif; font-size: 1.4em; }
        .brand-text span { font-size: 0.8em; opacity: 0.9; }
        .header-actions { display: flex; gap: 15px; align-items: center; }
        .btn { padding: 10px 20px; border: none; border-radius: 8px; font-weight: 600; cursor: pointer; transition: all 0.3s; display: flex; align-items: center; gap: 8px; }
        .btn-white { background: #fff; color: var(--neon-green); }
        .btn-dark { background: rgba(0,0,0,0.3); color: #fff; }
        .btn:hover { transform: translateY(-2px); }
        
        .main-layout { display: grid; grid-template-columns: 260px 1fr; min-height: calc(100vh - 70px); }
        
        .sidebar { background: var(--bg-card); border-right: 2px solid var(--neon-green); padding: 20px 0; }
        .sidebar-section { margin-bottom: 20px; }
        .sidebar-title { font-size: 0.7em; color: #666; text-transform: uppercase; letter-spacing: 1px; padding: 0 20px 10px; }
        .nav-item { display: flex; align-items: center; gap: 12px; padding: 12px 20px; cursor: pointer; transition: all 0.3s; border-left: 3px solid transparent; color: #ccc; }
        .nav-item:hover { background: rgba(0, 255, 65, 0.1); color: var(--neon-green); }
        .nav-item.active { background: rgba(0, 255, 65, 0.1); border-left-color: var(--neon-green); color: var(--neon-green); }
        .nav-item i { font-size: 1.1em; width: 24px; }
        
        .content { padding: 25px; overflow-y: auto; }
        .page-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 25px; }
        .page-title { font-family: 'Orbitron', sans-serif; font-size: 1.5em; color: var(--neon-green); }
        
        .dashboard-stats { display: grid; grid-template-columns: repeat(4, 1fr); gap: 20px; margin-bottom: 30px; }
        .stat-card { background: var(--bg-card); border: 2px solid var(--border); border-radius: 15px; padding: 20px; transition: all 0.3s; }
        .stat-card:hover { border-color: var(--neon-green); transform: translateY(-3px); }
        .stat-icon { width: 50px; height: 50px; border-radius: 12px; display: flex; align-items: center; justify-content: center; font-size: 1.5em; margin-bottom: 15px; }
        .stat-icon.green { background: rgba(0, 255, 65, 0.2); }
        .stat-icon.blue { background: rgba(0, 102, 255, 0.2); }
        .stat-icon.gold { background: rgba(255, 215, 0, 0.2); }
        .stat-icon.red { background: rgba(255, 51, 102, 0.2); }
        .stat-value { font-family: 'Orbitron', sans-serif; font-size: 1.8em; color: var(--neon-cyan); }
        .stat-label { font-size: 0.85em; color: #888; margin-top: 5px; }
        
        .card { background: var(--bg-card); border: 2px solid var(--border); border-radius: 15px; overflow: hidden; margin-bottom: 20px; }
        .card-header { padding: 15px 20px; border-bottom: 1px solid var(--border); display: flex; justify-content: space-between; align-items: center; }
        .card-title { font-family: 'Orbitron', sans-serif; color: var(--gold); }
        .card-body { padding: 20px; }
        
        table { width: 100%; border-collapse: collapse; }
        th { background: var(--bg-input); padding: 12px 15px; text-align: left; font-size: 0.85em; color: #888; }
        td { padding: 15px; border-bottom: 1px solid var(--border); }
        tr:hover { background: rgba(0, 255, 65, 0.05); }
        
        .account-card { background: var(--bg-card); border: 2px solid var(--border); border-radius: 15px; padding: 20px; margin-bottom: 15px; transition: all 0.3s; }
        .account-card:hover { border-color: var(--neon-green); transform: translateY(-3px); }
        .account-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; }
        .account-icon { width: 50px; height: 50px; border-radius: 12px; display: flex; align-items: center; justify-content: center; font-size: 1.5em; }
        .account-name { font-weight: 600; font-size: 1.1em; }
        .account-balance { font-family: 'Orbitron', sans-serif; font-size: 1.5em; color: var(--neon-cyan); }
        
        .form-row { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; }
        .form-group { margin-bottom: 15px; }
        .form-label { display: block; font-size: 0.85em; color: #888; margin-bottom: 8px; }
        .form-input, .form-select { width: 100%; padding: 12px 15px; background: var(--bg-input); border: 2px solid var(--border); border-radius: 10px; color: #fff; font-size: 0.95em; }
        .form-input:focus, .form-select:focus { border-color: var(--neon-green); outline: none; }
        
        .btn-primary { background: linear-gradient(135deg, var(--neon-green), var(--neon-cyan)); color: #000; font-weight: 700; }
        .btn-secondary { background: var(--bg-input); border: 2px solid var(--border); color: #fff; }
        
        .panel { display: none; }
        .panel.active { display: block; }
        
        .quick-actions { display: grid; grid-template-columns: repeat(4, 1fr); gap: 15px; margin-bottom: 30px; }
        .quick-action { background: var(--bg-card); border: 2px solid var(--border); border-radius: 15px; padding: 20px; text-align: center; cursor: pointer; transition: all 0.3s; }
        .quick-action:hover { border-color: var(--neon-green); transform: translateY(-3px); }
        .quick-action i { font-size: 2em; color: var(--neon-cyan); margin-bottom: 10px; display: block; }
        .quick-action h4 { margin-bottom: 5px; }
        
        .modal-overlay { display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.8); z-index: 1000; align-items: center; justify-content: center; }
        .modal-overlay.active { display: flex; }
        .modal { background: var(--bg-card); border: 2px solid var(--neon-green); border-radius: 20px; padding: 30px; min-width: 400px; max-width: 90vw; max-height: 90vh; overflow-y: auto; }
        .modal-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; }
        .modal-title { font-family: 'Orbitron', sans-serif; color: var(--neon-green); font-size: 1.3em; }
        .modal-close { background: none; border: none; color: #888; font-size: 1.5em; cursor: pointer; }
        
        .badge { padding: 4px 12px; border-radius: 15px; font-size: 0.8em; font-weight: 600; }
        .badge-success { background: rgba(0, 255, 65, 0.2); color: var(--neon-green); }
        .badge-warning { background: rgba(255, 215, 0, 0.2); color: var(--gold); }
        .badge-danger { background: rgba(255, 51, 102, 0.2); color: var(--neon-red); }
        
        .amount-positive { color: var(--neon-green); }
        .amount-negative { color: var(--neon-red); }
    </style>
</head>
<body>
    <header class="header">
        <div class="header-brand">
            <div class="brand-icon">ðŸ’°</div>
            <div class="brand-text">
                <h1>GoMoney</h1>
                <span>Personal Finance Management</span>
            </div>
        </div>
        <div class="header-actions">
            <button class="btn btn-dark" onclick="location.href='/index.html'">
                <i class="bi bi-house"></i> Home
            </button>
            <button class="btn btn-white" onclick="loadDashboard()">
                <i class="bi bi-arrow-clockwise"></i> Refresh
            </button>
        </div>
    </header>
    
    <div class="main-layout">
        <aside class="sidebar">
            <div class="sidebar-section">
                <div class="nav-item active" onclick="showPanel('dashboard')">
                    <i class="bi bi-speedometer2"></i>
                    <span>Dashboard</span>
                </div>
                <div class="nav-item" onclick="showPanel('accounts')">
                    <i class="bi bi-wallet2"></i>
                    <span>Accounts</span>
                </div>
                <div class="nav-item" onclick="showPanel('transactions')">
                    <i class="bi bi-list-ul"></i>
                    <span>Transactions</span>
                </div>
                <div class="nav-item" onclick="showPanel('income')">
                    <i class="bi bi-arrow-down-circle"></i>
                    <span>Income</span>
                </div>
                <div class="nav-item" onclick="showPanel('expenses')">
                    <i class="bi bi-arrow-up-circle"></i>
                    <span>Expenses</span>
                </div>
            </div>
            <div class="sidebar-section">
                <div class="sidebar-title">Management</div>
                <div class="nav-item" onclick="showPanel('payables')">
                    <i class="bi bi-file-earmark-text"></i>
                    <span>Payables</span>
                </div>
                <div class="nav-item" onclick="showPanel('receivables')">
                    <i class="bi bi-receipt"></i>
                    <span>Receivables</span>
                </div>
                <div class="nav-item" onclick="showPanel('budgets')">
                    <i class="bi bi-pie-chart"></i>
                    <span>Budgets</span>
                </div>
            </div>
            <div class="sidebar-section">
                <div class="sidebar-title">Reports</div>
                <div class="nav-item" onclick="showPanel('reports')">
                    <i class="bi bi-graph-up"></i>
                    <span>Financial Reports</span>
                </div>
            </div>
        </aside>
        
        <main class="content">
            <!-- Dashboard Panel -->
            <div id="panel-dashboard" class="panel active">
                <div class="page-header">
                    <h2 class="page-title">Financial Dashboard</h2>
                </div>
                
                <div class="dashboard-stats" id="dashboardStats">
                    <div class="stat-card">
                        <div class="stat-icon green"><i class="bi bi-wallet2"></i></div>
                        <div class="stat-value" id="totalBalance">$0.00</div>
                        <div class="stat-label">Total Balance</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon blue"><i class="bi bi-arrow-down-circle"></i></div>
                        <div class="stat-value amount-positive" id="totalIncome">$0.00</div>
                        <div class="stat-label">Total Income</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon red"><i class="bi bi-arrow-up-circle"></i></div>
                        <div class="stat-value amount-negative" id="totalExpense">$0.00</div>
                        <div class="stat-label">Total Expenses</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon gold"><i class="bi bi-graph-up-arrow"></i></div>
                        <div class="stat-value" id="netProfit">$0.00</div>
                        <div class="stat-label">Net Profit</div>
                    </div>
                </div>
                
                <div class="quick-actions">
                    <div class="quick-action" onclick="openModal('quickIncome')">
                        <i class="bi bi-plus-circle"></i>
                        <h4>Quick Income</h4>
                        <p>Add income transaction</p>
                    </div>
                    <div class="quick-action" onclick="openModal('quickExpense')">
                        <i class="bi bi-dash-circle"></i>
                        <h4>Quick Expense</h4>
                        <p>Add expense transaction</p>
                    </div>
                    <div class="quick-action" onclick="openModal('transfer')">
                        <i class="bi bi-arrow-left-right"></i>
                        <h4>Transfer</h4>
                        <p>Transfer between accounts</p>
                    </div>
                    <div class="quick-action" onclick="openModal('newAccount')">
                        <i class="bi bi-wallet2"></i>
                        <h4>New Account</h4>
                        <p>Add financial account</p>
                    </div>
                </div>
                
                <div class="card">
                    <div class="card-header">
                        <span class="card-title">Recent Transactions</span>
                    </div>
                    <div class="card-body">
                        <table id="recentTransactions">
                            <thead>
                                <tr>
                                    <th>Date</th>
                                    <th>Description</th>
                                    <th>Account</th>
                                    <th>Amount</th>
                                    <th>Type</th>
                                </tr>
                            </thead>
                            <tbody></tbody>
                        </table>
                    </div>
                </div>
                
                <div class="card">
                    <div class="card-header">
                        <span class="card-title">Accounts Overview</span>
                    </div>
                    <div class="card-body" id="accountsOverview"></div>
                </div>
            </div>
            
            <!-- Accounts Panel -->
            <div id="panel-accounts" class="panel">
                <div class="page-header">
                    <h2 class="page-title">Financial Accounts</h2>
                    <button class="btn btn-primary" onclick="openModal('newAccount')">
                        <i class="bi bi-plus"></i> New Account
                    </button>
                </div>
                <div id="accountsList"></div>
            </div>
            
            <!-- Transactions Panel -->
            <div id="panel-transactions" class="panel">
                <div class="page-header">
                    <h2 class="page-title">All Transactions</h2>
                    <div style="display: flex; gap: 10px;">
                        <button class="btn btn-primary" onclick="openModal('quickIncome')">
                            <i class="bi bi-plus"></i> Income
                        </button>
                        <button class="btn btn-secondary" onclick="openModal('quickExpense')">
                            <i class="bi bi-dash"></i> Expense
                        </button>
                    </div>
                </div>
                <div class="card">
                    <div class="card-body">
                        <table id="allTransactions">
                            <thead>
                                <tr>
                                    <th>Date</th>
                                    <th>Description</th>
                                    <th>Category</th>
                                    <th>Account</th>
                                    <th>Amount</th>
                                    <th>Type</th>
                                </tr>
                            </thead>
                            <tbody></tbody>
                        </table>
                    </div>
                </div>
            </div>
            
            <!-- Income Panel -->
            <div id="panel-income" class="panel">
                <div class="page-header">
                    <h2 class="page-title">Income</h2>
                    <button class="btn btn-primary" onclick="openModal('quickIncome')">
                        <i class="bi bi-plus"></i> Add Income
                    </button>
                </div>
                <div class="card">
                    <div class="card-body">
                        <table id="incomeTransactions">
                            <thead>
                                <tr>
                                    <th>Date</th>
                                    <th>Description</th>
                                    <th>Category</th>
                                    <th>Account</th>
                                    <th>Amount</th>
                                </tr>
                            </thead>
                            <tbody></tbody>
                        </table>
                    </div>
                </div>
            </div>
            
            <!-- Expenses Panel -->
            <div id="panel-expenses" class="panel">
                <div class="page-header">
                    <h2 class="page-title">Expenses</h2>
                    <button class="btn btn-primary" onclick="openModal('quickExpense')">
                        <i class="bi bi-plus"></i> Add Expense
                    </button>
                </div>
                <div class="card">
                    <div class="card-body">
                        <table id="expenseTransactions">
                            <thead>
                                <tr>
                                    <th>Date</th>
                                    <th>Description</th>
                                    <th>Category</th>
                                    <th>Account</th>
                                    <th>Amount</th>
                                </tr>
                            </thead>
                            <tbody></tbody>
                        </table>
                    </div>
                </div>
            </div>
            
            <!-- Payables Panel -->
            <div id="panel-payables" class="panel">
                <div class="page-header">
                    <h2 class="page-title">Accounts Payable</h2>
                    <button class="btn btn-primary" onclick="openModal('newPayable')">
                        <i class="bi bi-plus"></i> New Payable
                    </button>
                </div>
                <div class="card">
                    <div class="card-body">
                        <table id="payablesTable">
                            <thead>
                                <tr>
                                    <th>Creditor</th>
                                    <th>Description</th>
                                    <th>Total</th>
                                    <th>Paid</th>
                                    <th>Balance</th>
                                    <th>Due Date</th>
                                    <th>Status</th>
                                    <th>Action</th>
                                </tr>
                            </thead>
                            <tbody></tbody>
                        </table>
                    </div>
                </div>
            </div>
            
            <!-- Receivables Panel -->
            <div id="panel-receivables" class="panel">
                <div class="page-header">
                    <h2 class="page-title">Accounts Receivable</h2>
                    <button class="btn btn-primary" onclick="openModal('newReceivable')">
                        <i class="bi bi-plus"></i> New Receivable
                    </button>
                </div>
                <div class="card">
                    <div class="card-body">
                        <table id="receivablesTable">
                            <thead>
                                <tr>
                                    <th>Debtor</th>
                                    <th>Description</th>
                                    <th>Total</th>
                                    <th>Received</th>
                                    <th>Balance</th>
                                    <th>Due Date</th>
                                    <th>Status</th>
                                    <th>Action</th>
                                </tr>
                            </thead>
                            <tbody></tbody>
                        </table>
                    </div>
                </div>
            </div>
            
            <!-- Budgets Panel -->
            <div id="panel-budgets" class="panel">
                <div class="page-header">
                    <h2 class="page-title">Budgets</h2>
                    <button class="btn btn-primary" onclick="openModal('newBudget')">
                        <i class="bi bi-plus"></i> New Budget
                    </button>
                </div>
                <div id="budgetsList"></div>
            </div>
            
            <!-- Reports Panel -->
            <div id="panel-reports" class="panel">
                <div class="page-header">
                    <h2 class="page-title">Financial Reports</h2>
                </div>
                <div class="quick-actions">
                    <div class="quick-action" onclick="generateReport('income')">
                        <i class="bi bi-file-earmark-text"></i>
                        <h4>Income Report</h4>
                    </div>
                    <div class="quick-action" onclick="generateReport('expense')">
                        <i class="bi bi-file-earmark-text"></i>
                        <h4>Expense Report</h4>
                    </div>
                    <div class="quick-action" onclick="generateReport('profitloss')">
                        <i class="bi bi-graph-up"></i>
                        <h4>Profit & Loss</h4>
                    </div>
                    <div class="quick-action" onclick="generateReport('cashflow')">
                        <i class="bi bi-cash-stack"></i>
                        <h4>Cash Flow</h4>
                    </div>
                </div>
            </div>
        </main>
    </div>
    
    <!-- Modals -->
    <div id="modal-quickIncome" class="modal-overlay">
        <div class="modal">
            <div class="modal-header">
                <h3 class="modal-title">Quick Income</h3>
                <button class="modal-close" onclick="closeModal('quickIncome')">&times;</button>
            </div>
            <div class="card-body">
                <div class="form-group">
                    <label class="form-label">Account</label>
                    <select class="form-select" id="incomeAccount"></select>
                </div>
                <div class="form-group">
                    <label class="form-label">Amount</label>
                    <input type="number" class="form-input" id="incomeAmount" step="0.01" placeholder="0.00">
                </div>
                <div class="form-group">
                    <label class="form-label">Description</label>
                    <input type="text" class="form-input" id="incomeDescription" placeholder="Income description">
                </div>
                <button class="btn btn-primary" style="width: 100%;" onclick="submitQuickIncome()">Add Income</button>
            </div>
        </div>
    </div>
    
    <div id="modal-quickExpense" class="modal-overlay">
        <div class="modal">
            <div class="modal-header">
                <h3 class="modal-title">Quick Expense</h3>
                <button class="modal-close" onclick="closeModal('quickExpense')">&times;</button>
            </div>
            <div class="card-body">
                <div class="form-group">
                    <label class="form-label">Account</label>
                    <select class="form-select" id="expenseAccount"></select>
                </div>
                <div class="form-group">
                    <label class="form-label">Amount</label>
                    <input type="number" class="form-input" id="expenseAmount" step="0.01" placeholder="0.00">
                </div>
                <div class="form-group">
                    <label class="form-label">Description</label>
                    <input type="text" class="form-input" id="expenseDescription" placeholder="Expense description">
                </div>
                <button class="btn btn-primary" style="width: 100%;" onclick="submitQuickExpense()">Add Expense</button>
            </div>
        </div>
    </div>
    
    <div id="modal-newAccount" class="modal-overlay">
        <div class="modal">
            <div class="modal-header">
                <h3 class="modal-title">New Account</h3>
                <button class="modal-close" onclick="closeModal('newAccount')">&times;</button>
            </div>
            <div class="card-body">
                <div class="form-group">
                    <label class="form-label">Account Name</label>
                    <input type="text" class="form-input" id="accountName" placeholder="Account name">
                </div>
                <div class="form-group">
                    <label class="form-label">Type</label>
                    <select class="form-select" id="accountType">
                        <option value="Cash">Cash</option>
                        <option value="Checking">Checking</option>
                        <option value="Savings">Savings</option>
                        <option value="CreditCard">Credit Card</option>
                        <option value="Investment">Investment</option>
                        <option value="Crypto">Crypto</option>
                    </select>
                </div>
                <div class="form-group">
                    <label class="form-label">Initial Balance</label>
                    <input type="number" class="form-input" id="accountBalance" step="0.01" placeholder="0.00">
                </div>
                <button class="btn btn-primary" style="width: 100%;" onclick="submitNewAccount()">Create Account</button>
            </div>
        </div>
    </div>
    
    <script>
        const API_BASE = window.location.origin + '/api/finance';
        
        // Navigation
        function showPanel(panelId) {
            document.querySelectorAll('.panel').forEach(p => p.classList.remove('active'));
            document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
            document.getElementById('panel-' + panelId).classList.add('active');
            event.target.closest('.nav-item').classList.add('active');
            
            if (panelId === 'dashboard') loadDashboard();
            else if (panelId === 'accounts') loadAccounts();
            else if (panelId === 'transactions') loadTransactions();
            else if (panelId === 'income') loadIncome();
            else if (panelId === 'expenses') loadExpenses();
            else if (panelId === 'payables') loadPayables();
            else if (panelId === 'receivables') loadReceivables();
            else if (panelId === 'budgets') loadBudgets();
        }
        
        // Load Dashboard
        async function loadDashboard() {
            try {
                const res = await fetch(API_BASE);
                const dashboard = await res.json();
                
                document.getElementById('totalBalance').textContent = formatCurrency(dashboard.totalBalance);
                document.getElementById('totalIncome').textContent = formatCurrency(dashboard.totalIncome);
                document.getElementById('totalExpense').textContent = formatCurrency(dashboard.totalExpense);
                document.getElementById('netProfit').textContent = formatCurrency(dashboard.netProfit);
                
                // Recent transactions
                const tbody = document.querySelector('#recentTransactions tbody');
                tbody.innerHTML = dashboard.recentTransactions.map(t => `
                    <tr>
                        <td>${formatDate(t.date)}</td>
                        <td>${t.description || '-'}</td>
                        <td>${t.accountName}</td>
                        <td class="${t.type === 'Income' ? 'amount-positive' : 'amount-negative'}">
                            ${t.type === 'Income' ? '+' : '-'}${formatCurrency(t.amount)}
                        </td>
                        <td><span class="badge ${t.type === 'Income' ? 'badge-success' : 'badge-danger'}">${t.type}</span></td>
                    </tr>
                `).join('');
                
                // Accounts overview
                const accountsHtml = dashboard.accounts.map(a => `
                    <div class="account-card">
                        <div class="account-header">
                            <div style="display: flex; align-items: center; gap: 15px;">
                                <div class="account-icon" style="background: ${a.color || 'rgba(0,255,65,0.2)'}">
                                    ${a.icon || 'ðŸ’°'}
                                </div>
                                <div>
                                    <div class="account-name">${a.name}</div>
                                    <div style="font-size: 0.85em; color: #888;">${a.type}</div>
                                </div>
                            </div>
                            <div class="account-balance">${formatCurrency(a.balance)}</div>
                        </div>
                    </div>
                `).join('');
                document.getElementById('accountsOverview').innerHTML = accountsHtml;
                
            } catch (error) {
                console.error('Error loading dashboard:', error);
            }
        }
        
        // Load Accounts
        async function loadAccounts() {
            try {
                const res = await fetch(API_BASE + '/accounts');
                const accounts = await res.json();
                
                const html = accounts.map(a => `
                    <div class="account-card">
                        <div class="account-header">
                            <div style="display: flex; align-items: center; gap: 15px;">
                                <div class="account-icon" style="background: ${a.color || 'rgba(0,255,65,0.2)'}">
                                    ${a.icon || 'ðŸ’°'}
                                </div>
                                <div>
                                    <div class="account-name">${a.name}</div>
                                    <div style="font-size: 0.85em; color: #888;">${a.type} â€¢ ${a.currency}</div>
                                </div>
                            </div>
                            <div class="account-balance">${formatCurrency(a.balance)}</div>
                        </div>
                    </div>
                `).join('');
                document.getElementById('accountsList').innerHTML = html;
                
                // Populate account selects
                const selects = document.querySelectorAll('select[id$="Account"]');
                selects.forEach(select => {
                    select.innerHTML = '<option value="">Select account...</option>' + 
                        accounts.map(a => `<option value="${a.id}">${a.name}</option>`).join('');
                });
            } catch (error) {
                console.error('Error loading accounts:', error);
            }
        }
        
        // Load Transactions
        async function loadTransactions() {
            try {
                const res = await fetch(API_BASE + '/transactions');
                const transactions = await res.json();
                
                const tbody = document.querySelector('#allTransactions tbody');
                tbody.innerHTML = transactions.map(t => `
                    <tr>
                        <td>${formatDate(t.date)}</td>
                        <td>${t.description || '-'}</td>
                        <td>${t.categoryName || '-'}</td>
                        <td>${t.accountName}</td>
                        <td class="${t.type === 'Income' ? 'amount-positive' : 'amount-negative'}">
                            ${t.type === 'Income' ? '+' : '-'}${formatCurrency(t.amount)}
                        </td>
                        <td><span class="badge ${t.type === 'Income' ? 'badge-success' : 'badge-danger'}">${t.type}</span></td>
                    </tr>
                `).join('');
            } catch (error) {
                console.error('Error loading transactions:', error);
            }
        }
        
        // Load Income
        async function loadIncome() {
            try {
                const res = await fetch(API_BASE + '/transactions?type=Income');
                const transactions = await res.json();
                
                const tbody = document.querySelector('#incomeTransactions tbody');
                tbody.innerHTML = transactions.map(t => `
                    <tr>
                        <td>${formatDate(t.date)}</td>
                        <td>${t.description || '-'}</td>
                        <td>${t.categoryName || '-'}</td>
                        <td>${t.accountName}</td>
                        <td class="amount-positive">+${formatCurrency(t.amount)}</td>
                    </tr>
                `).join('');
            } catch (error) {
                console.error('Error loading income:', error);
            }
        }
        
        // Load Expenses
        async function loadExpenses() {
            try {
                const res = await fetch(API_BASE + '/transactions?type=Expense');
                const transactions = await res.json();
                
                const tbody = document.querySelector('#expenseTransactions tbody');
                tbody.innerHTML = transactions.map(t => `
                    <tr>
                        <td>${formatDate(t.date)}</td>
                        <td>${t.description || '-'}</td>
                        <td>${t.categoryName || '-'}</td>
                        <td>${t.accountName}</td>
                        <td class="amount-negative">-${formatCurrency(t.amount)}</td>
                    </tr>
                `).join('');
            } catch (error) {
                console.error('Error loading expenses:', error);
            }
        }
        
        // Load Payables
        async function loadPayables() {
            try {
                const res = await fetch(API_BASE + '/payables');
                const payables = await res.json();
                
                const tbody = document.querySelector('#payablesTable tbody');
                tbody.innerHTML = payables.map(p => `
                    <tr>
                        <td>${p.creditor}</td>
                        <td>${p.description || '-'}</td>
                        <td>${formatCurrency(p.totalAmount)}</td>
                        <td>${formatCurrency(p.paidAmount)}</td>
                        <td>${formatCurrency(p.balance)}</td>
                        <td>${formatDate(p.dueDate)}</td>
                        <td><span class="badge ${getPayableStatusBadge(p.status)}">${p.status}</span></td>
                        <td>
                            ${p.balance > 0 ? `<button class="btn btn-primary" style="padding: 5px 10px; font-size: 0.85em;" onclick="payPayable('${p.id}')">Pay</button>` : ''}
                        </td>
                    </tr>
                `).join('');
            } catch (error) {
                console.error('Error loading payables:', error);
            }
        }
        
        // Load Receivables
        async function loadReceivables() {
            try {
                const res = await fetch(API_BASE + '/receivables');
                const receivables = await res.json();
                
                const tbody = document.querySelector('#receivablesTable tbody');
                tbody.innerHTML = receivables.map(r => `
                    <tr>
                        <td>${r.debtor}</td>
                        <td>${r.description || '-'}</td>
                        <td>${formatCurrency(r.totalAmount)}</td>
                        <td>${formatCurrency(r.receivedAmount)}</td>
                        <td>${formatCurrency(r.balance)}</td>
                        <td>${formatDate(r.dueDate)}</td>
                        <td><span class="badge ${getReceivableStatusBadge(r.status)}">${r.status}</span></td>
                        <td>
                            ${r.balance > 0 ? `<button class="btn btn-primary" style="padding: 5px 10px; font-size: 0.85em;" onclick="receiveReceivable('${r.id}')">Receive</button>` : ''}
                        </td>
                    </tr>
                `).join('');
            } catch (error) {
                console.error('Error loading receivables:', error);
            }
        }
        
        // Load Budgets
        async function loadBudgets() {
            try {
                const res = await fetch(API_BASE + '/budgets');
                const budgets = await res.json();
                
                const html = budgets.map(b => `
                    <div class="account-card">
                        <div class="account-header">
                            <div>
                                <div class="account-name">${b.categoryName}</div>
                                <div style="font-size: 0.85em; color: #888;">Budget: ${formatCurrency(b.amount)}</div>
                            </div>
                            <div>
                                <div class="account-balance">${formatCurrency(b.spentAmount)}</div>
                                <div style="font-size: 0.85em; color: #888;">${b.usagePercent.toFixed(1)}% used</div>
                            </div>
                        </div>
                    </div>
                `).join('');
                document.getElementById('budgetsList').innerHTML = html;
            } catch (error) {
                console.error('Error loading budgets:', error);
            }
        }
        
        // Modal functions
        function openModal(modalId) {
            document.getElementById('modal-' + modalId).classList.add('active');
            if (modalId === 'quickIncome' || modalId === 'quickExpense' || modalId === 'newAccount') {
                loadAccounts();
            }
        }
        
        function closeModal(modalId) {
            document.getElementById('modal-' + modalId).classList.remove('active');
        }
        
        // Submit functions
        async function submitQuickIncome() {
            const accountId = document.getElementById('incomeAccount').value;
            const amount = parseFloat(document.getElementById('incomeAmount').value);
            const description = document.getElementById('incomeDescription').value;
            
            if (!accountId || !amount) {
                alert('Please fill all required fields');
                return;
            }
            
            try {
                const res = await fetch(API_BASE + '/transactions/quick-income', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ accountId, amount, description })
                });
                
                if (res.ok) {
                    closeModal('quickIncome');
                    loadDashboard();
                    document.getElementById('incomeAmount').value = '';
                    document.getElementById('incomeDescription').value = '';
                }
            } catch (error) {
                console.error('Error adding income:', error);
            }
        }
        
        async function submitQuickExpense() {
            const accountId = document.getElementById('expenseAccount').value;
            const amount = parseFloat(document.getElementById('expenseAmount').value);
            const description = document.getElementById('expenseDescription').value;
            
            if (!accountId || !amount) {
                alert('Please fill all required fields');
                return;
            }
            
            try {
                const res = await fetch(API_BASE + '/transactions/quick-expense', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ accountId, amount, description })
                });
                
                if (res.ok) {
                    closeModal('quickExpense');
                    loadDashboard();
                    document.getElementById('expenseAmount').value = '';
                    document.getElementById('expenseDescription').value = '';
                }
            } catch (error) {
                console.error('Error adding expense:', error);
            }
        }
        
        async function submitNewAccount() {
            const name = document.getElementById('accountName').value;
            const type = document.getElementById('accountType').value;
            const balance = parseFloat(document.getElementById('accountBalance').value) || 0;
            
            if (!name) {
                alert('Please enter account name');
                return;
            }
            
            try {
                const res = await fetch(API_BASE + '/accounts', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ name, type, initialBalance: balance })
                });
                
                if (res.ok) {
                    closeModal('newAccount');
                    loadAccounts();
                    document.getElementById('accountName').value = '';
                    document.getElementById('accountBalance').value = '';
                }
            } catch (error) {
                console.error('Error creating account:', error);
            }
        }
        
        function generateReport(type) {
            const from = prompt('From date (YYYY-MM-DD):', new Date(new Date().getFullYear(), 0, 1).toISOString().split('T')[0]);
            const to = prompt('To date (YYYY-MM-DD):', new Date().toISOString().split('T')[0]);
            
            if (from && to) {
                window.open(`${API_BASE}/reports/${type}?from=${from}&to=${to}`, '_blank');
            }
        }
        
        function getPayableStatusBadge(status) {
            if (status === 'Paid') return 'badge-success';
            if (status === 'Overdue') return 'badge-danger';
            return 'badge-warning';
        }
        
        function getReceivableStatusBadge(status) {
            if (status === 'Received') return 'badge-success';
            if (status === 'Overdue') return 'badge-danger';
            return 'badge-warning';
        }
        
        function formatCurrency(amount) {
            return new Intl.NumberFormat('en-US', { style: 'currency', currency: 'USD' }).format(amount);
        }
        
        function formatDate(date) {
            return new Date(date).toLocaleDateString();
        }
        
        // Initialize
        loadDashboard();
        loadAccounts();
    </script>
</body>
</html>
