<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>IERAHKWA HRM | Human Resource Management System</title>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;500;600;700;800;900&family=Exo+2:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.0/font/bootstrap-icons.css" rel="stylesheet">
    <style>
        :root {
            --gold: #FFD700;
            --gold-dark: #B8860B;
            --neon-green: #00FF41;
            --neon-cyan: #00FFFF;
            --neon-magenta: #FF00FF;
            --neon-orange: #FF6B35;
            --neon-purple: #9D4EDD;
            --neon-pink: #FF1493;
            --bg-dark: #0a0e17;
            --bg-card: #0d1a2d;
            --border: #1e3a5f;
        }
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Exo 2', sans-serif;
            background: linear-gradient(135deg, #0a0e17 0%, #0d1a2d 50%, #1a0a2e 100%);
            color: #fff;
            min-height: 100vh;
        }
        .bg-animation {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            pointer-events: none; z-index: 0;
            background: radial-gradient(circle at 20% 80%, rgba(255,215,0,0.05) 0%, transparent 50%),
                radial-gradient(circle at 80% 20%, rgba(0,255,65,0.05) 0%, transparent 50%);
        }
        .container { position: relative; z-index: 1; max-width: 1800px; margin: 0 auto; padding: 20px 40px; }

        .header {
            background: linear-gradient(180deg, rgba(10,14,23,0.98), rgba(13,26,45,0.95));
            border-bottom: 3px solid;
            border-image: linear-gradient(90deg, var(--gold), var(--neon-green), var(--neon-cyan), var(--gold)) 1;
            padding: 18px 40px; position: sticky; top: 0; z-index: 100; backdrop-filter: blur(10px);
        }
        .header-content { display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 16px; }
        .logo { display: flex; align-items: center; gap: 16px; }
        .logo-icon {
            width: 56px; height: 56px; background: linear-gradient(135deg, var(--gold), var(--gold-dark));
            border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 26px;
            box-shadow: 0 0 24px rgba(255,215,0,0.5);
        }
        .logo-text h1 { font-family: 'Orbitron', sans-serif; font-size: 1.5em; background: linear-gradient(90deg, var(--gold), var(--neon-green)); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
        .logo-text p { color: var(--neon-cyan); font-size: 0.85em; letter-spacing: 2px; }
        .version-badge { background: linear-gradient(135deg, var(--neon-green), #00cc33); color: #000; padding: 4px 12px; border-radius: 16px; font-family: 'Orbitron'; font-weight: 700; font-size: 0.75em; }
        .back-link { color: var(--neon-cyan); text-decoration: none; display: inline-flex; align-items: center; gap: 6px; font-size: 0.9em; }
        .back-link:hover { color: var(--gold); }

        .section-header { display: flex; align-items: center; gap: 12px; margin-bottom: 20px; padding-bottom: 12px; border-bottom: 2px solid var(--border); }
        .section-header h2 { font-family: 'Orbitron'; font-size: 1.3em; }
        .section-header .icon { width: 44px; height: 44px; border-radius: 10px; display: flex; align-items: center; justify-content: center; font-size: 20px; }

        .stats-row { display: grid; grid-template-columns: repeat(auto-fit, minmax(140px, 1fr)); gap: 12px; margin-bottom: 28px; }
        .stat-box {
            background: var(--bg-card); border-radius: 12px; padding: 16px; border: 1px solid var(--border);
            text-align: center; transition: all 0.3s;
        }
        .stat-box:hover { border-color: var(--gold); box-shadow: 0 0 20px rgba(255,215,0,0.15); }
        .stat-value { font-family: 'Orbitron'; font-size: 1.6em; color: var(--gold); }
        .stat-label { font-size: 0.8em; color: #888; margin-top: 4px; }

        .charts-row { display: grid; grid-template-columns: repeat(auto-fit, minmax(320px, 1fr)); gap: 20px; margin-bottom: 28px; }
        .chart-card { background: var(--bg-card); border-radius: 14px; padding: 20px; border: 1px solid var(--border); }
        .chart-title { font-family: 'Orbitron'; font-size: 1em; color: var(--neon-cyan); margin-bottom: 14px; }
        .bar-chart { display: flex; flex-direction: column; gap: 10px; }
        .bar-row { display: flex; align-items: center; gap: 10px; }
        .bar-label { min-width: 80px; font-size: 0.85em; color: #aaa; }
        .bar-track { flex: 1; height: 20px; background: rgba(255,255,255,0.08); border-radius: 10px; overflow: hidden; }
        .bar-fill { height: 100%; border-radius: 10px; background: linear-gradient(90deg, var(--gold), var(--neon-green)); transition: width 0.5s; }
        .bar-val { font-size: 0.85em; color: var(--gold); min-width: 32px; text-align: right; }

        .modules-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); gap: 14px; margin-bottom: 28px; }
        .module-card {
            background: var(--bg-card); border-radius: 12px; padding: 18px; border: 2px solid transparent;
            cursor: pointer; transition: all 0.3s; text-decoration: none; color: inherit; display: block;
        }
        .module-card:hover { transform: translateY(-4px); }
        .module-card.gold { border-color: rgba(255,215,0,0.4); }
        .module-card.gold:hover { box-shadow: 0 8px 24px rgba(255,215,0,0.2); }
        .module-card.green { border-color: rgba(0,255,65,0.4); }
        .module-card.green:hover { box-shadow: 0 8px 24px rgba(0,255,65,0.2); }
        .module-card.cyan { border-color: rgba(0,255,255,0.4); }
        .module-card.cyan:hover { box-shadow: 0 8px 24px rgba(0,255,255,0.2); }
        .module-card.magenta { border-color: rgba(255,0,255,0.4); }
        .module-card.magenta:hover { box-shadow: 0 8px 24px rgba(255,0,255,0.2); }
        .module-card.orange { border-color: rgba(255,107,53,0.4); }
        .module-card.orange:hover { box-shadow: 0 8px 24px rgba(255,107,53,0.2); }
        .module-card.purple { border-color: rgba(157,78,221,0.4); }
        .module-card.purple:hover { box-shadow: 0 8px 24px rgba(157,78,221,0.2); }
        .module-icon { font-size: 28px; margin-bottom: 8px; }
        .module-title { font-family: 'Orbitron'; font-size: 0.95em; }
        .module-desc { font-size: 0.8em; color: #888; margin-top: 4px; }

        .notifications-panel { background: var(--bg-card); border-radius: 14px; padding: 20px; border: 1px solid var(--border); margin-bottom: 24px; }
        .notif-item { padding: 10px 0; border-bottom: 1px solid rgba(255,255,255,0.06); display: flex; gap: 12px; align-items: flex-start; }
        .notif-item:last-child { border-bottom: none; }
        .notif-icon { font-size: 18px; color: var(--neon-cyan); flex-shrink: 0; }
        .notif-title { font-weight: 600; font-size: 0.95em; }
        .notif-msg { font-size: 0.85em; color: #888; margin-top: 2px; }
        .notif-time { font-size: 0.75em; color: #666; margin-top: 4px; }

        .loading { text-align: center; padding: 40px; color: var(--neon-cyan); }
        .error { color: #ff6b6b; padding: 12px; background: rgba(255,107,107,0.1); border-radius: 8px; margin-bottom: 16px; }
        .footer { text-align: center; padding: 24px; color: #666; font-size: 0.9em; border-top: 1px solid var(--border); margin-top: 24px; }
        @media (max-width: 768px) { .container { padding: 16px; } .header { padding: 14px 16px; } }
    </style>
</head>
<body>
    <div class="bg-animation"></div>

    <header class="header">
        <div class="header-content">
            <div class="logo">
                <div class="logo-icon">üë•</div>
                <div class="logo-text">
                    <h1>IERAHKWA HRM</h1>
                    <p>HUMAN RESOURCE MANAGEMENT SYSTEM</p>
                </div>
                <span class="version-badge">.NET 10</span>
            </div>
            <a class="back-link" href="#" onclick="if(history.length>1)history.back();else window.location='http://localhost:8545/platform';return false"><i class="bi bi-arrow-left"></i> Volver a IERAHKWA</a>
        </div>
    </header>

    <main class="container">
        <div class="section-header">
            <div class="icon" style="background: linear-gradient(135deg, var(--gold), var(--neon-green)); color: #000;">üìä</div>
            <h2 style="color: var(--gold);">DASHBOARD</h2>
        </div>

        <div id="error" class="error" style="display:none;"></div>
        <div id="loading" class="loading">Cargando estad√≠sticas‚Ä¶</div>

        <div id="statsRow" class="stats-row" style="display:none;">
            <div class="stat-box"><div class="stat-value" id="sTotal">0</div><div class="stat-label">Empleados</div></div>
            <div class="stat-box"><div class="stat-value" id="sActive">0</div><div class="stat-label">Activos</div></div>
            <div class="stat-box"><div class="stat-value" id="sPresent">0</div><div class="stat-label">Presentes hoy</div></div>
            <div class="stat-box"><div class="stat-value" id="sOnLeave">0</div><div class="stat-label">En vacaciones</div></div>
            <div class="stat-box"><div class="stat-value" id="sPendingLeave">0</div><div class="stat-label">Solicitudes pendientes</div></div>
            <div class="stat-box"><div class="stat-value" id="sRecruit">0</div><div class="stat-label">Reclutamiento abierto</div></div>
            <div class="stat-box"><div class="stat-value" id="sProjects">0</div><div class="stat-label">Proyectos activos</div></div>
            <div class="stat-box"><div class="stat-value" id="sPayroll">$0</div><div class="stat-label">N√≥mina del mes</div></div>
        </div>

        <div id="chartsRow" class="charts-row" style="display:none;">
            <div class="chart-card">
                <div class="chart-title">Asistencia (√∫ltimos 7 d√≠as)</div>
                <div class="bar-chart" id="chartAttendance"></div>
            </div>
            <div class="chart-card">
                <div class="chart-title">Empleados por departamento</div>
                <div class="bar-chart" id="chartDept"></div>
            </div>
        </div>

        <div class="section-header">
            <div class="icon" style="background: linear-gradient(135deg, var(--neon-cyan), #0099cc); color: #000;">‚öôÔ∏è</div>
            <h2 style="color: var(--neon-cyan);">M√ìDULOS HRM</h2>
        </div>
        <div class="modules-grid">
            <a class="module-card gold" href="#" onclick="alert('Empleados: /api/employees'); return false;">
                <div class="module-icon"><i class="bi bi-people"></i></div>
                <div class="module-title">Empleados</div>
                <div class="module-desc">Altas, perfiles, organigrama</div>
            </a>
            <a class="module-card green" href="#" onclick="alert('Asistencia: /api/attendance'); return false;">
                <div class="module-icon"><i class="bi bi-calendar-check"></i></div>
                <div class="module-title">Asistencia</div>
                <div class="module-desc">Check-in/out, reportes</div>
            </a>
            <a class="module-card cyan" href="#" onclick="alert('Permisos: /api/leave'); return false;">
                <div class="module-icon"><i class="bi bi-calendar-event"></i></div>
                <div class="module-title">Permisos / Vacaciones</div>
                <div class="module-desc">Solicitudes y aprobaciones</div>
            </a>
            <a class="module-card gold" href="#" onclick="alert('N√≥mina: /api/payroll'); return false;">
                <div class="module-icon"><i class="bi bi-cash-stack"></i></div>
                <div class="module-title">N√≥mina</div>
                <div class="module-desc">Pagos, impuestos, reportes</div>
            </a>
            <a class="module-card magenta" href="#" onclick="alert('Pr√©stamos: /api/loans'); return false;">
                <div class="module-icon"><i class="bi bi-bank"></i></div>
                <div class="module-title">Pr√©stamos</div>
                <div class="module-desc">Sistema de pr√©stamos</div>
            </a>
            <a class="module-card orange" href="#" onclick="alert('Reclutamiento: /api/recruitment'); return false;">
                <div class="module-icon"><i class="bi bi-person-badge"></i></div>
                <div class="module-title">Reclutamiento</div>
                <div class="module-desc">Vacantes, candidatos</div>
            </a>
            <a class="module-card purple" href="#" onclick="alert('Premios: /api/awards'); return false;">
                <div class="module-icon"><i class="bi bi-trophy"></i></div>
                <div class="module-title">Premios al empleado</div>
                <div class="module-desc">Reconocimientos, puntos</div>
            </a>
            <a class="module-card green" href="#" onclick="alert('Proyectos: /api/projects'); return false;">
                <div class="module-icon"><i class="bi bi-kanban"></i></div>
                <div class="module-title">Gesti√≥n de proyectos</div>
                <div class="module-desc">Avance, puntos recompensa</div>
            </a>
            <a class="module-card cyan" href="#" onclick="alert('Compras: /api/procurement'); return false;">
                <div class="module-icon"><i class="bi bi-cart-check"></i></div>
                <div class="module-title">Compras / Procurement</div>
                <div class="module-desc">Proveedores, √≥rdenes</div>
            </a>
            <a class="module-card orange" href="#" onclick="alert('Impuestos: /api/tax'); return false;">
                <div class="module-icon"><i class="bi bi-percent"></i></div>
                <div class="module-title">Impuestos</div>
                <div class="module-desc">Configuraci√≥n fiscal</div>
            </a>
            <a class="module-card purple" href="#" onclick="alert('Puntos: /api/rewardpoints'); return false;">
                <div class="module-icon"><i class="bi bi-star"></i></div>
                <div class="module-title">Puntos de recompensa</div>
                <div class="module-desc">Por proyectos y premios</div>
            </a>
            <a class="module-card magenta" href="#" onclick="alert('Roles: /api/roles'); return false;">
                <div class="module-icon"><i class="bi bi-shield-lock"></i></div>
                <div class="module-title">Roles y permisos</div>
                <div class="module-desc">Control de acceso</div>
            </a>
        </div>

        <div class="section-header">
            <div class="icon" style="background: linear-gradient(135deg, var(--neon-orange), #cc4400); color: #fff;">üîî</div>
            <h2 style="color: var(--neon-orange);">NOTIFICACIONES</h2>
        </div>
        <div class="notifications-panel" id="notifPanel">
            <div class="loading">Cargando notificaciones‚Ä¶</div>
        </div>
    </main>

    <footer class="footer">
        IERAHKWA HRM ‚Ä¢ .NET 10 ‚Ä¢ Sovereign Government of Ierahkwa Ne Kanienke ‚Ä¢ Integrado en IERAHKWA Platform
    </footer>

    <script>
        (function() {
            const isFile = typeof window !== 'undefined' && (window.location.protocol === 'file:' || !window.location.origin || window.location.origin === 'null');
            window.API_BASE = window.API_BASE || (isFile ? 'http://localhost:5060' : '');
        })();

        function api(url) { return (window.API_BASE || '') + url; }

        function showErr(msg) {
            var el = document.getElementById('error');
            if (el) { el.textContent = msg; el.style.display = 'block'; }
        }
        function hideErr() {
            var el = document.getElementById('error');
            if (el) el.style.display = 'none';
        }

        function renderBarChart(containerId, data, maxVal) {
            var c = document.getElementById(containerId);
            if (!c || !Array.isArray(data)) return;
            var m = maxVal || Math.max(1, ...data.map(function(d) { return d.value; }));
            c.innerHTML = data.map(function(d) {
                var p = m > 0 ? Math.round((d.value / m) * 100) : 0;
                return '<div class="bar-row"><span class="bar-label">' + (d.label || '') + '</span><div class="bar-track"><div class="bar-fill" style="width:' + p + '%"></div></div><span class="bar-val">' + d.value + '</span></div>';
            }).join('');
        }

        async function loadDashboard() {
            hideErr();
            var loading = document.getElementById('loading');
            var statsRow = document.getElementById('statsRow');
            var chartsRow = document.getElementById('chartsRow');
            try {
                var r = await fetch(api('/api/dashboard/stats'));
                if (!r.ok) throw new Error('Error ' + r.status);
                var s = await r.json();
                if (loading) loading.style.display = 'none';
                if (statsRow) {
                    statsRow.style.display = 'grid';
                    document.getElementById('sTotal').textContent = s.totalEmployees ?? 0;
                    document.getElementById('sActive').textContent = s.activeEmployees ?? 0;
                    document.getElementById('sPresent').textContent = s.presentToday ?? 0;
                    document.getElementById('sOnLeave').textContent = s.onLeave ?? 0;
                    document.getElementById('sPendingLeave').textContent = s.pendingLeaves ?? 0;
                    document.getElementById('sRecruit').textContent = s.openRecruitments ?? 0;
                    document.getElementById('sProjects').textContent = s.activeProjects ?? 0;
                    document.getElementById('sPayroll').textContent = '$' + (s.monthlyPayroll ?? 0).toLocaleString();
                }
                if (chartsRow && s.attendanceChart) {
                    chartsRow.style.display = 'grid';
                    renderBarChart('chartAttendance', s.attendanceChart.length ? s.attendanceChart : [{ label: '-', value: 0 }]);
                    renderBarChart('chartDept', s.departmentChart && s.departmentChart.length ? s.departmentChart : [{ label: '-', value: 0 }]);
                }
            } catch (e) {
                if (loading) loading.style.display = 'none';
                showErr('No se pudo conectar con la API HRM. Aseg√∫rate de que HRM.API est√© corriendo en http://localhost:5060');
            }
        }

        async function loadNotifications() {
            var panel = document.getElementById('notifPanel');
            if (!panel) return;
            try {
                var r = await fetch(api('/api/notifications'));
                if (!r.ok) return;
                var list = await r.json();
                panel.innerHTML = (Array.isArray(list) && list.length)
                    ? list.slice(0, 5).map(function(n) {
                        var icon = n.type === 'Warning' ? 'exclamation-triangle' : (n.type === 'Success' ? 'check-circle' : 'info-circle');
                        return '<div class="notif-item"><i class="bi bi-' + icon + ' notif-icon"></i><div><div class="notif-title">' + (n.title || '') + '</div><div class="notif-msg">' + (n.message || '') + '</div><div class="notif-time">' + (n.createdAt ? new Date(n.createdAt).toLocaleString() : '') + '</div></div></div>';
                    }).join('')
                    : '<div class="notif-item"><span class="notif-msg">No hay notificaciones.</span></div>';
            } catch (_) {
                panel.innerHTML = '<div class="notif-msg">No se pudieron cargar las notificaciones.</div>';
            }
        }

        loadDashboard();
        loadNotifications();
    </script>
</body>
</html>
