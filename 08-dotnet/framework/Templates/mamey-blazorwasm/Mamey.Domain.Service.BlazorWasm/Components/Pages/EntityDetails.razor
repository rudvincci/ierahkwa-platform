@page "/service/{Id:guid}"
@using Mamey.Domain.Service.Contracts
@inject IServiceService Service
@inject NavigationManager Navigation
@inject ISnackbar Snackbar
@inject IDialogService DialogService

<PageTitle>Entity Details</PageTitle>

<MudContainer MaxWidth="MaxWidth.Medium" Class="mt-4">
    @if (_entity == null)
    {
        <MudProgressLinear Color="Color.Primary" Indeterminate="true" />
    }
    else
    {
        <MudText Typo="Typo.h4" Class="mb-4">Entity Details</MudText>
        
        <MudCard>
            <MudCardContent>
                <MudText Typo="Typo.h6">ID</MudText>
                <MudText>@_entity.Id</MudText>
                
                <MudText Typo="Typo.h6" Class="mt-4">Name</MudText>
                <MudText>@_entity.Name</MudText>
            </MudCardContent>
            
            <MudCardActions>
                <MudButton Variant="Variant.Filled" 
                          Color="Color.Primary"
                          StartIcon="@Icons.Material.Filled.Edit"
                          Href="/service/@Id/edit">
                    Edit
                </MudButton>
                
                <MudButton Variant="Variant.Filled" 
                          Color="Color.Error"
                          StartIcon="@Icons.Material.Filled.Delete"
                          OnClick="OnDelete">
                    Delete
                </MudButton>
                
                <MudButton Variant="Variant.Text" 
                          Color="Color.Default"
                          Href="/service">
                    Back to List
                </MudButton>
            </MudCardActions>
        </MudCard>
    }
</MudContainer>

@code {
    [Parameter] public Guid Id { get; set; }
    
    private EntityDto? _entity;

    protected override async Task OnInitializedAsync()
    {
        _entity = await Service.GetByIdAsync(Id);
    }

    private async Task OnDelete()
    {
        var confirmed = await DialogService.ShowMessageBox(
            "Confirm Delete",
            "Are you sure you want to delete this entity?",
            yesText: "Delete", cancelText: "Cancel");
        
        if (confirmed == true)
        {
            try
            {
                await Service.DeleteAsync(Id);
                Snackbar.Add("Entity deleted successfully", Severity.Success);
                Navigation.NavigateTo("/service");
            }
            catch (Exception ex)
            {
                Snackbar.Add($"Error deleting entity: {ex.Message}", Severity.Error);
            }
        }
    }
}

