{
  "Logging": {
    "LogLevel": {
      "Default": "Information",
      "Microsoft.AspNetCore": "Warning",
      "Yarp": "Information"
    }
  },
  "Serilog": {
    "MinimumLevel": {
      "Default": "Information",
      "Override": {
        "Microsoft": "Warning",
        "System": "Warning"
      }
    },
    "WriteTo": [
      { "Name": "Console" },
      {
        "Name": "Seq",
        "Args": {
          "serverUrl": "http://seq:5341"
        }
      }
    ]
  },
  "Jwt": {
    "Issuer": "pupitre-platform",
    "Audience": "pupitre-services"
  },
  "Cors": {
    "AllowedOrigins": [
      "https://student.pupitre.io",
      "https://parent.pupitre.io",
      "https://educator.pupitre.io",
      "https://admin.pupitre.io"
    ]
  },
  "IpRateLimiting": {
    "EnableEndpointRateLimiting": true,
    "StackBlockedRequests": false,
    "RealIpHeader": "X-Real-IP",
    "ClientIdHeader": "X-ClientId",
    "HttpStatusCode": 429,
    "GeneralRules": [
      {
        "Endpoint": "*",
        "Period": "1m",
        "Limit": 200
      },
      {
        "Endpoint": "*:/api/ai/*",
        "Period": "1m",
        "Limit": 60
      },
      {
        "Endpoint": "*:/api/auth/*",
        "Period": "1m",
        "Limit": 20
      }
    ]
  },
  "ReverseProxy": {
    "Routes": {
      "users-route": {
        "ClusterId": "users-cluster",
        "AuthorizationPolicy": "authenticated",
        "Match": { "Path": "/api/users/{**catch-all}" },
        "Transforms": [{ "PathRemovePrefix": "/api/users" }]
      },
      "gles-route": {
        "ClusterId": "gles-cluster",
        "Match": { "Path": "/api/gles/{**catch-all}" },
        "Transforms": [{ "PathRemovePrefix": "/api/gles" }]
      },
      "curricula-route": {
        "ClusterId": "curricula-cluster",
        "Match": { "Path": "/api/curricula/{**catch-all}" },
        "Transforms": [{ "PathRemovePrefix": "/api/curricula" }]
      },
      "lessons-route": {
        "ClusterId": "lessons-cluster",
        "Match": { "Path": "/api/lessons/{**catch-all}" },
        "Transforms": [{ "PathRemovePrefix": "/api/lessons" }]
      },
      "assessments-route": {
        "ClusterId": "assessments-cluster",
        "AuthorizationPolicy": "authenticated",
        "Match": { "Path": "/api/assessments/{**catch-all}" },
        "Transforms": [{ "PathRemovePrefix": "/api/assessments" }]
      },
      "ieps-route": {
        "ClusterId": "ieps-cluster",
        "AuthorizationPolicy": "educator-or-admin",
        "Match": { "Path": "/api/ieps/{**catch-all}" },
        "Transforms": [{ "PathRemovePrefix": "/api/ieps" }]
      },
      "rewards-route": {
        "ClusterId": "rewards-cluster",
        "AuthorizationPolicy": "authenticated",
        "Match": { "Path": "/api/rewards/{**catch-all}" },
        "Transforms": [{ "PathRemovePrefix": "/api/rewards" }]
      },
      "notifications-route": {
        "ClusterId": "notifications-cluster",
        "AuthorizationPolicy": "authenticated",
        "Match": { "Path": "/api/notifications/{**catch-all}" },
        "Transforms": [{ "PathRemovePrefix": "/api/notifications" }]
      },
      "credentials-route": {
        "ClusterId": "credentials-cluster",
        "AuthorizationPolicy": "authenticated",
        "Match": { "Path": "/api/credentials/{**catch-all}" },
        "Transforms": [{ "PathRemovePrefix": "/api/credentials" }]
      },
      "analytics-route": {
        "ClusterId": "analytics-cluster",
        "AuthorizationPolicy": "educator-or-admin",
        "Match": { "Path": "/api/analytics/{**catch-all}" },
        "Transforms": [{ "PathRemovePrefix": "/api/analytics" }]
      },
      "ai-tutors-route": {
        "ClusterId": "ai-tutors-cluster",
        "AuthorizationPolicy": "authenticated",
        "Match": { "Path": "/api/ai/tutors/{**catch-all}" },
        "Transforms": [{ "PathRemovePrefix": "/api/ai/tutors" }]
      },
      "ai-assessments-route": {
        "ClusterId": "ai-assessments-cluster",
        "AuthorizationPolicy": "authenticated",
        "Match": { "Path": "/api/ai/assessments/{**catch-all}" },
        "Transforms": [{ "PathRemovePrefix": "/api/ai/assessments" }]
      },
      "ai-content-route": {
        "ClusterId": "ai-content-cluster",
        "AuthorizationPolicy": "authenticated",
        "Match": { "Path": "/api/ai/content/{**catch-all}" },
        "Transforms": [{ "PathRemovePrefix": "/api/ai/content" }]
      },
      "ai-speech-route": {
        "ClusterId": "ai-speech-cluster",
        "AuthorizationPolicy": "authenticated",
        "Match": { "Path": "/api/ai/speech/{**catch-all}" },
        "Transforms": [{ "PathRemovePrefix": "/api/ai/speech" }]
      },
      "ai-adaptive-route": {
        "ClusterId": "ai-adaptive-cluster",
        "AuthorizationPolicy": "authenticated",
        "Match": { "Path": "/api/ai/adaptive/{**catch-all}" },
        "Transforms": [{ "PathRemovePrefix": "/api/ai/adaptive" }]
      },
      "ai-behavior-route": {
        "ClusterId": "ai-behavior-cluster",
        "AuthorizationPolicy": "educator-or-admin",
        "Match": { "Path": "/api/ai/behavior/{**catch-all}" },
        "Transforms": [{ "PathRemovePrefix": "/api/ai/behavior" }]
      },
      "ai-safety-route": {
        "ClusterId": "ai-safety-cluster",
        "AuthorizationPolicy": "admin-only",
        "Match": { "Path": "/api/ai/safety/{**catch-all}" },
        "Transforms": [{ "PathRemovePrefix": "/api/ai/safety" }]
      },
      "ai-recommendations-route": {
        "ClusterId": "ai-recommendations-cluster",
        "AuthorizationPolicy": "authenticated",
        "Match": { "Path": "/api/ai/recommendations/{**catch-all}" },
        "Transforms": [{ "PathRemovePrefix": "/api/ai/recommendations" }]
      },
      "ai-translation-route": {
        "ClusterId": "ai-translation-cluster",
        "Match": { "Path": "/api/ai/translation/{**catch-all}" },
        "Transforms": [{ "PathRemovePrefix": "/api/ai/translation" }]
      },
      "ai-vision-route": {
        "ClusterId": "ai-vision-cluster",
        "AuthorizationPolicy": "authenticated",
        "Match": { "Path": "/api/ai/vision/{**catch-all}" },
        "Transforms": [{ "PathRemovePrefix": "/api/ai/vision" }]
      },
      "parents-route": {
        "ClusterId": "parents-cluster",
        "AuthorizationPolicy": "parent-or-admin",
        "Match": { "Path": "/api/parents/{**catch-all}" },
        "Transforms": [{ "PathRemovePrefix": "/api/parents" }]
      },
      "educators-route": {
        "ClusterId": "educators-cluster",
        "AuthorizationPolicy": "educator-or-admin",
        "Match": { "Path": "/api/educators/{**catch-all}" },
        "Transforms": [{ "PathRemovePrefix": "/api/educators" }]
      },
      "fundraising-route": {
        "ClusterId": "fundraising-cluster",
        "Match": { "Path": "/api/fundraising/{**catch-all}" },
        "Transforms": [{ "PathRemovePrefix": "/api/fundraising" }]
      },
      "bookstore-route": {
        "ClusterId": "bookstore-cluster",
        "Match": { "Path": "/api/bookstore/{**catch-all}" },
        "Transforms": [{ "PathRemovePrefix": "/api/bookstore" }]
      },
      "aftercare-route": {
        "ClusterId": "aftercare-cluster",
        "AuthorizationPolicy": "authenticated",
        "Match": { "Path": "/api/aftercare/{**catch-all}" },
        "Transforms": [{ "PathRemovePrefix": "/api/aftercare" }]
      },
      "accessibility-route": {
        "ClusterId": "accessibility-cluster",
        "AuthorizationPolicy": "authenticated",
        "Match": { "Path": "/api/accessibility/{**catch-all}" },
        "Transforms": [{ "PathRemovePrefix": "/api/accessibility" }]
      },
      "compliance-route": {
        "ClusterId": "compliance-cluster",
        "AuthorizationPolicy": "admin-only",
        "Match": { "Path": "/api/compliance/{**catch-all}" },
        "Transforms": [{ "PathRemovePrefix": "/api/compliance" }]
      },
      "ministries-route": {
        "ClusterId": "ministries-cluster",
        "AuthorizationPolicy": "ministry-or-admin",
        "Match": { "Path": "/api/ministries/{**catch-all}" },
        "Transforms": [{ "PathRemovePrefix": "/api/ministries" }]
      },
      "operations-route": {
        "ClusterId": "operations-cluster",
        "AuthorizationPolicy": "admin-only",
        "Match": { "Path": "/api/operations/{**catch-all}" },
        "Transforms": [{ "PathRemovePrefix": "/api/operations" }]
      }
    },
    "Clusters": {
      "users-cluster": {
        "LoadBalancingPolicy": "RoundRobin",
        "HealthCheck": { "Active": { "Enabled": true, "Interval": "00:00:30", "Timeout": "00:00:10", "Path": "/health" } },
        "Destinations": { "destination1": { "Address": "http://pupitre-users:60001" } }
      },
      "gles-cluster": {
        "LoadBalancingPolicy": "RoundRobin",
        "HealthCheck": { "Active": { "Enabled": true, "Interval": "00:00:30", "Timeout": "00:00:10", "Path": "/health" } },
        "Destinations": { "destination1": { "Address": "http://pupitre-gles:60002" } }
      },
      "curricula-cluster": {
        "LoadBalancingPolicy": "RoundRobin",
        "HealthCheck": { "Active": { "Enabled": true, "Interval": "00:00:30", "Timeout": "00:00:10", "Path": "/health" } },
        "Destinations": { "destination1": { "Address": "http://pupitre-curricula:60003" } }
      },
      "lessons-cluster": {
        "LoadBalancingPolicy": "RoundRobin",
        "HealthCheck": { "Active": { "Enabled": true, "Interval": "00:00:30", "Timeout": "00:00:10", "Path": "/health" } },
        "Destinations": { "destination1": { "Address": "http://pupitre-lessons:60004" } }
      },
      "assessments-cluster": {
        "LoadBalancingPolicy": "RoundRobin",
        "HealthCheck": { "Active": { "Enabled": true, "Interval": "00:00:30", "Timeout": "00:00:10", "Path": "/health" } },
        "Destinations": { "destination1": { "Address": "http://pupitre-assessments:60005" } }
      },
      "ieps-cluster": {
        "LoadBalancingPolicy": "RoundRobin",
        "HealthCheck": { "Active": { "Enabled": true, "Interval": "00:00:30", "Timeout": "00:00:10", "Path": "/health" } },
        "Destinations": { "destination1": { "Address": "http://pupitre-ieps:60006" } }
      },
      "rewards-cluster": {
        "LoadBalancingPolicy": "RoundRobin",
        "HealthCheck": { "Active": { "Enabled": true, "Interval": "00:00:30", "Timeout": "00:00:10", "Path": "/health" } },
        "Destinations": { "destination1": { "Address": "http://pupitre-rewards:60007" } }
      },
      "notifications-cluster": {
        "LoadBalancingPolicy": "RoundRobin",
        "HealthCheck": { "Active": { "Enabled": true, "Interval": "00:00:30", "Timeout": "00:00:10", "Path": "/health" } },
        "Destinations": { "destination1": { "Address": "http://pupitre-notifications:60008" } }
      },
      "credentials-cluster": {
        "LoadBalancingPolicy": "RoundRobin",
        "HealthCheck": { "Active": { "Enabled": true, "Interval": "00:00:30", "Timeout": "00:00:10", "Path": "/health" } },
        "Destinations": { "destination1": { "Address": "http://pupitre-credentials:60009" } }
      },
      "analytics-cluster": {
        "LoadBalancingPolicy": "RoundRobin",
        "HealthCheck": { "Active": { "Enabled": true, "Interval": "00:00:30", "Timeout": "00:00:10", "Path": "/health" } },
        "Destinations": { "destination1": { "Address": "http://pupitre-analytics:60010" } }
      },
      "ai-tutors-cluster": {
        "LoadBalancingPolicy": "RoundRobin",
        "HealthCheck": { "Active": { "Enabled": true, "Interval": "00:00:30", "Timeout": "00:00:10", "Path": "/health" } },
        "Destinations": { "destination1": { "Address": "http://pupitre-ai-tutors:60011" } }
      },
      "ai-assessments-cluster": {
        "LoadBalancingPolicy": "RoundRobin",
        "HealthCheck": { "Active": { "Enabled": true, "Interval": "00:00:30", "Timeout": "00:00:10", "Path": "/health" } },
        "Destinations": { "destination1": { "Address": "http://pupitre-ai-assessments:60012" } }
      },
      "ai-content-cluster": {
        "LoadBalancingPolicy": "RoundRobin",
        "HealthCheck": { "Active": { "Enabled": true, "Interval": "00:00:30", "Timeout": "00:00:10", "Path": "/health" } },
        "Destinations": { "destination1": { "Address": "http://pupitre-ai-content:60013" } }
      },
      "ai-speech-cluster": {
        "LoadBalancingPolicy": "RoundRobin",
        "HealthCheck": { "Active": { "Enabled": true, "Interval": "00:00:30", "Timeout": "00:00:10", "Path": "/health" } },
        "Destinations": { "destination1": { "Address": "http://pupitre-ai-speech:60014" } }
      },
      "ai-adaptive-cluster": {
        "LoadBalancingPolicy": "RoundRobin",
        "HealthCheck": { "Active": { "Enabled": true, "Interval": "00:00:30", "Timeout": "00:00:10", "Path": "/health" } },
        "Destinations": { "destination1": { "Address": "http://pupitre-ai-adaptive:60015" } }
      },
      "ai-behavior-cluster": {
        "LoadBalancingPolicy": "RoundRobin",
        "HealthCheck": { "Active": { "Enabled": true, "Interval": "00:00:30", "Timeout": "00:00:10", "Path": "/health" } },
        "Destinations": { "destination1": { "Address": "http://pupitre-ai-behavior:60016" } }
      },
      "ai-safety-cluster": {
        "LoadBalancingPolicy": "RoundRobin",
        "HealthCheck": { "Active": { "Enabled": true, "Interval": "00:00:30", "Timeout": "00:00:10", "Path": "/health" } },
        "Destinations": { "destination1": { "Address": "http://pupitre-ai-safety:60017" } }
      },
      "ai-recommendations-cluster": {
        "LoadBalancingPolicy": "RoundRobin",
        "HealthCheck": { "Active": { "Enabled": true, "Interval": "00:00:30", "Timeout": "00:00:10", "Path": "/health" } },
        "Destinations": { "destination1": { "Address": "http://pupitre-ai-recommendations:60018" } }
      },
      "ai-translation-cluster": {
        "LoadBalancingPolicy": "RoundRobin",
        "HealthCheck": { "Active": { "Enabled": true, "Interval": "00:00:30", "Timeout": "00:00:10", "Path": "/health" } },
        "Destinations": { "destination1": { "Address": "http://pupitre-ai-translation:60019" } }
      },
      "ai-vision-cluster": {
        "LoadBalancingPolicy": "RoundRobin",
        "HealthCheck": { "Active": { "Enabled": true, "Interval": "00:00:30", "Timeout": "00:00:10", "Path": "/health" } },
        "Destinations": { "destination1": { "Address": "http://pupitre-ai-vision:60020" } }
      },
      "parents-cluster": {
        "LoadBalancingPolicy": "RoundRobin",
        "HealthCheck": { "Active": { "Enabled": true, "Interval": "00:00:30", "Timeout": "00:00:10", "Path": "/health" } },
        "Destinations": { "destination1": { "Address": "http://pupitre-parents:60021" } }
      },
      "educators-cluster": {
        "LoadBalancingPolicy": "RoundRobin",
        "HealthCheck": { "Active": { "Enabled": true, "Interval": "00:00:30", "Timeout": "00:00:10", "Path": "/health" } },
        "Destinations": { "destination1": { "Address": "http://pupitre-educators:60022" } }
      },
      "fundraising-cluster": {
        "LoadBalancingPolicy": "RoundRobin",
        "HealthCheck": { "Active": { "Enabled": true, "Interval": "00:00:30", "Timeout": "00:00:10", "Path": "/health" } },
        "Destinations": { "destination1": { "Address": "http://pupitre-fundraising:60023" } }
      },
      "bookstore-cluster": {
        "LoadBalancingPolicy": "RoundRobin",
        "HealthCheck": { "Active": { "Enabled": true, "Interval": "00:00:30", "Timeout": "00:00:10", "Path": "/health" } },
        "Destinations": { "destination1": { "Address": "http://pupitre-bookstore:60024" } }
      },
      "aftercare-cluster": {
        "LoadBalancingPolicy": "RoundRobin",
        "HealthCheck": { "Active": { "Enabled": true, "Interval": "00:00:30", "Timeout": "00:00:10", "Path": "/health" } },
        "Destinations": { "destination1": { "Address": "http://pupitre-aftercare:60025" } }
      },
      "accessibility-cluster": {
        "LoadBalancingPolicy": "RoundRobin",
        "HealthCheck": { "Active": { "Enabled": true, "Interval": "00:00:30", "Timeout": "00:00:10", "Path": "/health" } },
        "Destinations": { "destination1": { "Address": "http://pupitre-accessibility:60026" } }
      },
      "compliance-cluster": {
        "LoadBalancingPolicy": "RoundRobin",
        "HealthCheck": { "Active": { "Enabled": true, "Interval": "00:00:30", "Timeout": "00:00:10", "Path": "/health" } },
        "Destinations": { "destination1": { "Address": "http://pupitre-compliance:60027" } }
      },
      "ministries-cluster": {
        "LoadBalancingPolicy": "RoundRobin",
        "HealthCheck": { "Active": { "Enabled": true, "Interval": "00:00:30", "Timeout": "00:00:10", "Path": "/health" } },
        "Destinations": { "destination1": { "Address": "http://pupitre-ministries:60028" } }
      },
      "operations-cluster": {
        "LoadBalancingPolicy": "RoundRobin",
        "HealthCheck": { "Active": { "Enabled": true, "Interval": "00:00:30", "Timeout": "00:00:10", "Path": "/health" } },
        "Destinations": { "destination1": { "Address": "http://pupitre-operations:60029" } }
      }
    }
  }
}
