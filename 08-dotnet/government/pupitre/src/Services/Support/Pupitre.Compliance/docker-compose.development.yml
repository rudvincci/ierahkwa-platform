version: '3'

services:
  compliance-service:
    build:
      context: ../
      dockerfile: Pupitre.Compliance/Dockerfile
      args:
        FEED_URL: ${FEED_URL}
        FEED_PAT: ${FEED_PAT}
        FEED_NAME: ${FEED_NAME}
        FEED_USERNAME: ${FEED_USERNAME}
    image: compliance-service
    container_name: compliance-service
    env_file: 
      - ./.env-development
    environment:
      - ASPNETCORE_ENVIRONMENT=docker
      - ASPNETCORE_URLS=https://+:443;http://+:80
      - ASPNETCORE_HTTPS_PORT=60027
      - ASPNETCORE_Kestrel__Certificates__Default__Path=${Certificates__Default__Path}
      - ASPNETCORE_Kestrel__Certificates__Default__Password=${Certificates__Default__Password}
    restart: unless-stopped
    ports:
      - 60027:443
      - 5001:80
    networks:
      - mamey
    volumes:
      - ~/.aspnet/https:/https:ro
      - ~/.microsoft/usersecrets:/root/.microsoft/usersecrets:ro

networks:
  mamey:
    name: mamey
    external: true