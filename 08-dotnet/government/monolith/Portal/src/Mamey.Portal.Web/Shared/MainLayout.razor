@inherits LayoutComponentBase

@using Mamey.Portal.Shared.Tenancy
@using Mamey.Portal.Tenant.Application.Services
@inject ITenantContext Tenant
@inject ITenantOnboardingService TenantOnboarding

<MudThemeProvider />
<MudPopoverProvider />
<MudDialogProvider />
<MudSnackbarProvider />

<MudLayout>
    <MudAppBar Elevation="1">
        <MudIconButton Icon="@Icons.Material.Filled.Menu" Color="Color.Inherit" Edge="Edge.Start" OnClick="ToggleDrawer" />
        <MudText Typo="Typo.h6">@_appTitle</MudText>
        <MudSpacer />
        <UserMenu />
    </MudAppBar>

    <MudDrawer @bind-Open="_drawerOpen" Variant="DrawerVariant.Responsive" Elevation="1">
        <MudNavMenu>
            <MudNavLink Href="/" Match="NavLinkMatch.All" Icon="@Icons.Material.Filled.Home">Home</MudNavLink>

            <MudDivider Class="my-2" />

            <MudText Typo="Typo.overline" Class="px-4 pt-2">Public</MudText>
            <MudNavLink Href="/about-us" Icon="@Icons.Material.Filled.Info">About</MudNavLink>
            <MudNavLink Href="/our-history" Icon="@Icons.Material.Filled.HistoryEdu">Our History</MudNavLink>
            <MudNavLink Href="/cabinet" Icon="@Icons.Material.Filled.Groups">Cabinet</MudNavLink>
            <MudNavLink Href="/recognitions" Icon="@Icons.Material.Filled.Verified">Recognitions</MudNavLink>
            <MudNavLink Href="/library" Icon="@Icons.Material.Filled.LibraryBooks">Library</MudNavLink>
            <MudNavLink Href="/become-a-citizen" Icon="@Icons.Material.Filled.AssignmentInd">Become a Citizen</MudNavLink>
            <MudNavLink Href="/public/validate-citizen" Icon="@Icons.Material.Filled.Badge">Validate Citizen ID</MudNavLink>

            <MudDivider Class="my-2" />

            <MudText Typo="Typo.overline" Class="px-4 pt-2">Portals</MudText>
            <MudNavLink Href="/citizen/dashboard" Icon="@Icons.Material.Filled.Person">Citizen Portal</MudNavLink>
            <MudNavLink Href="/gov/dashboard" Icon="@Icons.Material.Filled.AdminPanelSettings">Government Portal</MudNavLink>
            <MudNavLink Href="/gov/applications" Icon="@Icons.Material.Filled.FactCheck">Gov: Applications</MudNavLink>
            <MudNavLink Href="/gov/manual-application" Icon="@Icons.Material.Filled.NoteAdd">Gov: Manual Entry</MudNavLink>
            <MudNavLink Href="/gov/document-naming" Icon="@Icons.Material.Filled.TextFields">Gov: Document Naming</MudNavLink>
            <MudNavLink Href="/gov/tenants" Icon="@Icons.Material.Filled.Domain">Gov: Tenants (Admin)</MudNavLink>
            <MudNavLink Href="/gov/user-tenant-mappings" Icon="@Icons.Material.Filled.Badge">Gov: User → Tenant</MudNavLink>
            <MudNavLink Href="/gov/tenant-invites" Icon="@Icons.Material.Filled.Mail">Gov: Tenant Invites</MudNavLink>
            <MudNavLink Href="/gov/progression-applications" Icon="@Icons.Material.Filled.TrendingUp">Gov: Status Progression</MudNavLink>
            <MudNavLink Href="/gov/library" Icon="@Icons.Material.Filled.LibraryBooks">Gov: Library</MudNavLink>
            <MudNavLink Href="/cms" Icon="@Icons.Material.Filled.EditNote">CMS</MudNavLink>
        </MudNavMenu>
    </MudDrawer>

    <MudMainContent Class="pa-4">
        @Body
    </MudMainContent>
</MudLayout>

@code {
    private bool _drawerOpen = true;
    private string _appTitle = "Mamey Portal";

    private void ToggleDrawer() => _drawerOpen = !_drawerOpen;

    protected override async Task OnInitializedAsync()
    {
        try
        {
            var settings = await TenantOnboarding.GetSettingsAsync(Tenant.TenantId);
            var displayName = settings?.Branding.DisplayName;
            _appTitle = string.IsNullOrWhiteSpace(displayName) ? $"Mamey Portal ({Tenant.TenantId})" : displayName;
        }
        catch
        {
            _appTitle = $"Mamey Portal ({Tenant.TenantId})";
        }
    }
}
