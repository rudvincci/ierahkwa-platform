@page "/citizen/support"
@layout CitizenLayout
@attribute [Authorize]

<PageTitle>Support - Citizen Portal</PageTitle>

<PageHeader Title="Support Center" Subtitle="Get help with your questions and issues" />

<MudGrid Spacing="3">
    <MudItem xs="12" md="8">
        <MudCard Elevation="2">
            <MudCardHeader>
                <CardHeaderContent>
                    <MudText Typo="Typo.h6">Contact Support</MudText>
                </CardHeaderContent>
            </MudCardHeader>
            <MudCardContent>
                <MudTextField @bind-Value="_subject" Label="Subject" Variant="Variant.Outlined" Required="true" />
                
                <MudSelect @bind-Value="_category" Label="Category" Variant="Variant.Outlined" Class="mt-4" Required="true">
                    <MudSelectItem Value="@("general")">General Inquiry</MudSelectItem>
                    <MudSelectItem Value="@("documents")">Document Issues</MudSelectItem>
                    <MudSelectItem Value="@("account")">Account Problems</MudSelectItem>
                    <MudSelectItem Value="@("technical")">Technical Support</MudSelectItem>
                    <MudSelectItem Value="@("other")">Other</MudSelectItem>
                </MudSelect>

                <MudTextField @bind-Value="_message" Label="Message" Variant="Variant.Outlined" 
                              Lines="6" Class="mt-4" Required="true" 
                              Placeholder="Please describe your issue or question in detail..." />
            </MudCardContent>
            <MudCardActions>
                <MudButton Variant="Variant.Filled" Color="Color.Primary" StartIcon="@Icons.Material.Filled.Send">
                    Send Message
                </MudButton>
            </MudCardActions>
        </MudCard>

        <MudCard Elevation="2" Class="mt-4">
            <MudCardHeader>
                <CardHeaderContent>
                    <MudText Typo="Typo.h6">Support History</MudText>
                </CardHeaderContent>
            </MudCardHeader>
            <MudCardContent>
                <MudTable Items="@_tickets" Hover="true" Striped="true" Dense="true">
                    <HeaderContent>
                        <MudTh>Ticket #</MudTh>
                        <MudTh>Subject</MudTh>
                        <MudTh>Status</MudTh>
                        <MudTh>Date</MudTh>
                    </HeaderContent>
                    <RowTemplate>
                        <MudTd>@context.TicketId</MudTd>
                        <MudTd>@context.Subject</MudTd>
                        <MudTd><MudChip T="string" Color="@GetStatusColor(context.Status)" Size="Size.Small">@context.Status</MudChip></MudTd>
                        <MudTd>@context.Date.ToString("MMM dd, yyyy")</MudTd>
                    </RowTemplate>
                </MudTable>
            </MudCardContent>
        </MudCard>
    </MudItem>

    <MudItem xs="12" md="4">
        <MudCard Elevation="2">
            <MudCardHeader>
                <CardHeaderContent>
                    <MudText Typo="Typo.h6">Contact Information</MudText>
                </CardHeaderContent>
            </MudCardHeader>
            <MudCardContent>
                <MudList T="string" Dense="true">
                    <MudListItem Icon="@Icons.Material.Filled.Email">
                        <MudStack Spacing="0">
                            <MudText Typo="Typo.caption">Email</MudText>
                            <MudText Typo="Typo.body2">support@mamey.gov</MudText>
                        </MudStack>
                    </MudListItem>
                    <MudListItem Icon="@Icons.Material.Filled.Phone">
                        <MudStack Spacing="0">
                            <MudText Typo="Typo.caption">Phone</MudText>
                            <MudText Typo="Typo.body2">+1 (555) 123-4567</MudText>
                        </MudStack>
                    </MudListItem>
                    <MudListItem Icon="@Icons.Material.Filled.Schedule">
                        <MudStack Spacing="0">
                            <MudText Typo="Typo.caption">Hours</MudText>
                            <MudText Typo="Typo.body2">Mon-Fri 9am-5pm</MudText>
                        </MudStack>
                    </MudListItem>
                </MudList>
            </MudCardContent>
        </MudCard>

        <MudCard Elevation="2" Class="mt-4">
            <MudCardHeader>
                <CardHeaderContent>
                    <MudText Typo="Typo.h6">Quick Links</MudText>
                </CardHeaderContent>
            </MudCardHeader>
            <MudCardContent>
                <MudList T="string" Dense="true">
                    <MudListItem Icon="@Icons.Material.Filled.Help" Href="/faq">FAQ</MudListItem>
                    <MudListItem Icon="@Icons.Material.Filled.Description" Href="/library">Documentation</MudListItem>
                </MudList>
            </MudCardContent>
        </MudCard>
    </MudItem>
</MudGrid>

@code {
    private string? _subject;
    private string? _category;
    private string? _message;

    private record SupportTicket(string TicketId, string Subject, string Status, DateTime Date);

    private readonly List<SupportTicket> _tickets = new()
    {
        new("TKT-001", "Question about renewal", "Resolved", DateTime.Now.AddDays(-10)),
        new("TKT-002", "Document not showing", "Closed", DateTime.Now.AddDays(-20))
    };

    private Color GetStatusColor(string status) => status switch
    {
        "Open" => Color.Primary,
        "InProgress" => Color.Warning,
        "Resolved" => Color.Success,
        "Closed" => Color.Default,
        _ => Color.Default
    };
}
