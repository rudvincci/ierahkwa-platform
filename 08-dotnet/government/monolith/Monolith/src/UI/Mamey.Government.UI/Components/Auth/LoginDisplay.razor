@using Microsoft.AspNetCore.Components.Authorization

<AuthorizeView>
    <Authorized>
        <MudStack Row="true" Spacing="2" AlignItems="AlignItems.Center">
            <MudAvatar Color="Color.Primary" Size="Size.Small">
                @GetInitials(context.User.Identity?.Name)
            </MudAvatar>
            <MudStack Spacing="0">
                <MudText Typo="Typo.body2">@context.User.Identity?.Name</MudText>
                <MudText Typo="Typo.caption" Class="mud-text-secondary">
                    @(context.User.FindFirst(System.Security.Claims.ClaimTypes.Role)?.Value ?? "Citizen")
                </MudText>
            </MudStack>
        </MudStack>
    </Authorized>
    <NotAuthorized>
        <MudButton Variant="Variant.Outlined" Color="Color.Primary" Href="/auth/login" StartIcon="@Icons.Material.Filled.Login">
            Sign In
        </MudButton>
    </NotAuthorized>
</AuthorizeView>

@code {
    private static string GetInitials(string? name)
    {
        if (string.IsNullOrWhiteSpace(name))
            return "?";
        
        var parts = name.Split(' ', StringSplitOptions.RemoveEmptyEntries);
        if (parts.Length >= 2)
            return $"{parts[0][0]}{parts[1][0]}".ToUpper();
        
        return name.Length >= 2 ? name[..2].ToUpper() : name.ToUpper();
    }
}
