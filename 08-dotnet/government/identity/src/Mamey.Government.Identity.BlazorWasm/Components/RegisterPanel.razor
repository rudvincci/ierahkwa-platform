@* @page "/Account/Register" *@
@* *@
@* @using System.ComponentModel.DataAnnotations *@
@* @using System.Text *@
@* @using System.Text.Encodings.Web *@
@* @using Mamey.Auth.Identity.Managers *@
@* @using Microsoft.AspNetCore.Components.Forms *@
@* @using Microsoft.AspNetCore.Identity *@
@* @using Microsoft.AspNetCore.Identity.EntityFrameworkCore *@
@* @using Microsoft.AspNetCore.WebUtilities *@
@* @using Microsoft.Extensions.Logging *@
@* @using MudBlazor.StaticInput *@
@* @using Mamey.BlazorWasm.Shared *@
@* @using Mamey.Types *@
@* *@
@* *@
@* @inject ILogger<Register> Logger *@
@* @inject NavigationManager NavigationManager *@
@* @inject IIdentityRedirectManager RedirectManager *@
@* *@
@* *@
@* <MudGrid> *@
@*     <MudItem md="6"> *@
@*         <StatusMessage Message="@Message" /> *@
@*         <EditForm Model="Input" asp-route-returnUrl="@ReturnUrl" method="post" OnValidSubmit="RegisterUser" FormName="register"> *@
@*             <DataAnnotationsValidator /> *@
@* *@
@*             <MudText Typo="Typo.body1" GutterBottom="true">Create a new account.</MudText> *@
@* *@
@*             <MudGrid> *@
@*                 <MudItem md="12"> *@
@*                     <MudStaticTextField For="@(() => Input.Email)" @bind-Value="Input.Email" *@
@*                                         Label="Email" Placeholder="name@example.com" *@
@*                                         UserAttributes="@(new() { { "autocomplete", "username" }, { "aria-required", "true" } } )" /> *@
@*                 </MudItem> *@
@*                 <MudItem md="12"> *@
@*                     <MudStaticTextField For="@(() => Input.Password)" @bind-Value="Input.Password" *@
@*                                         Label="Password" InputType="InputType.Password" Placeholder="password" *@
@*                                         UserAttributes="@(new() { { "autocomplete", "new-password" }, { "aria-required", "true" } } )" /> *@
@*                 </MudItem> *@
@*                 <MudItem md="12"> *@
@*                     <MudStaticTextField For="@(() => Input.ConfirmPassword)" @bind-Value="Input.ConfirmPassword" *@
@*                                         Label="Confirm Password" InputType="InputType.Password" Placeholder="confirm password" *@
@*                                         UserAttributes="@(new() { { "autocomplete", "new-password" }, { "aria-required", "true" } } )" /> *@
@*                 </MudItem> *@
@*                 <MudItem md="12"> *@
@*                     <MudStaticButton Variant="Variant.Filled" Color="Color.Primary" FullWidth="true" FormAction="FormAction.Submit">Register</MudStaticButton> *@
@*                 </MudItem> *@
@*             </MudGrid> *@
@*         </EditForm> *@
@*     </MudItem> *@
@*     <MudItem md="6"> *@
@*         <MudText Typo="Typo.body1" GutterBottom="true">Use another service to register.</MudText> *@
@*         $1$ <ExternalLoginPicker /> #1# *@
@*     </MudItem> *@
@* </MudGrid> *@
@* *@
@* @code { *@
@*     private IEnumerable<IdentityError>? identityErrors; *@
@*     [Inject] private IAuthService AuthService { get; set; } *@
@* *@
@*     [SupplyParameterFromForm] *@
@*     private InputModel Input { get; set; } = new(); *@
@* *@
@*     [SupplyParameterFromQuery] *@
@*     private string? ReturnUrl { get; set; } *@
@* *@
@*     private string? Message => identityErrors is null ? null : $"Error: {string.Join(", ", identityErrors.Select(error => error.Description))}"; *@
@* *@
@*     public async Task RegisterUser(EditContext editContext) *@
@*     { *@
@*         await AuthService.RegisterAsync(new Register(Guid.NewGuid(), Input.Username, Input.Name, Input.Email,Input.Password, Input.Phone)); *@
@*          *@
@*         RedirectManager.RedirectTo( *@
@*             "Account/RegisterConfirmation", *@
@*             new Dictionary<string, object?>() { ["email"] = Input.Email, ["returnUrl"] = ReturnUrl }); *@
@*         // RedirectManager.RedirectTo(ReturnUrl); *@
@*     } *@
@*      *@
@*     private sealed class InputModel *@
@*     { *@
@*         [Required] *@
@*         [Display(Name = "Username")] *@
@*         public string Username { get; set; } = ""; *@
@*         [Required] *@
@*         [Display(Name = "Name")] *@
@*         public Name Name { get; set; } = new(); *@
@*          *@
@*         [Required] *@
@*         [EmailAddress] *@
@*         [Display(Name = "Email")] *@
@*         public string Email { get; set; } = ""; *@
@*         [Required] *@
@*         [Display(Name = "Phone")] *@
@*         public Phone Phone { get; set; } = new(); *@
@* *@
@*         [Required] *@
@*         [StringLength(100, ErrorMessage = "The {0} must be at least {2} and at max {1} characters long.", MinimumLength = 6)] *@
@*         [DataType(DataType.Password)] *@
@*         [Display(Name = "Password")] *@
@*         public string Password { get; set; } = ""; *@
@* *@
@*         [DataType(DataType.Password)] *@
@*         [Display(Name = "Confirm password")] *@
@*         [Compare("Password", ErrorMessage = "The password and confirmation password do not match.")] *@
@*         public string ConfirmPassword { get; set; } = ""; *@
@*     } *@
@* } *@
